---
heroImage: /src/assets/images/Effects/post_3S/cover.png
category: å®è·µè®°å½•
description: Unity URPç®¡çº¿ä¸‹çš„3Sæè´¨å¿«é€Ÿæ¨¡æ‹Ÿ
pubDate: 2024-02-25T16:00:00.000Z
tags:
  - æ•ˆæœå®ç°
title: å¿«é€Ÿæ¬¡è¡¨é¢æ•£å°„æ¨¡æ‹Ÿ
---

import LocalVideo from '../../components/LocalVideo.astro'

<LocalVideo src='/assets/Effects/3S/video5.mp4' alt='video5' />

### æ•ˆæœä»‹ç»

#### 3Sææ–™

The quality of allowing light to pass partially and diffusely inside media.

<img
	src='/assets/Effects/3S/img1.png'
	alt='img1'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

#### å›¾å½¢å­¦ä¸­çš„3Sæ¨¡æ‹Ÿ

> ğŸ“£ æ¬¡è¡¨é¢æ•£å°„ï¼ˆSubsurface Scatteringï¼Œ ç®€ç§° SSSï¼‰æ˜¯æŒ‡å…‰çº¿è¿›å…¥åŠé€æ˜ææ–™çš„è¡¨é¢åï¼Œåœ¨ææ–™å†…éƒ¨å‘ç”Ÿå¤šæ¬¡æ•£å°„å’Œå¸æ”¶ï¼Œå¹¶æœ€ç»ˆé‡æ–°ä»ææ–™è¡¨é¢å°„å‡ºçš„ç°è±¡ã€‚

**å…‰çº¿çš„å…¥å°„**ï¼š å…‰çº¿å‡»ä¸­ç‰©ä½“è¡¨é¢åï¼Œä¸€éƒ¨åˆ†ä¼šè¢«ç›´æ¥åå°„ï¼Œå¦ä¸€éƒ¨åˆ†ä¼š*è¿›å…¥ç‰©ä½“å†…éƒ¨*ã€‚( BRDF)

**å¤šæ¬¡æ•£å°„ä¸å¸æ”¶**ï¼š å…‰çº¿è¿›å…¥ææ–™åï¼Œä¼š*ä¸ææ–™ä¸­çš„å¾®ç²’æˆ–ç»“æ„ç›¸äº’ä½œç”¨ï¼Œå‘ç”Ÿå¤šæ¬¡æ•£å°„å’Œå¸æ”¶*ã€‚ ( BSSRDF)

- ææ–™çš„å¸æ”¶ç³»æ•°ï¼ˆAbsorption Coefficientï¼‰å†³å®šäº†å…‰çº¿åœ¨ä¼ æ’­è¿‡ç¨‹ä¸­æŸå¤±å¤šå°‘èƒ½é‡
- æ•£å°„ç³»æ•°ï¼ˆScattering Coefficientï¼‰å†³å®šäº†å…‰çº¿çš„æ•£å°„å¼ºåº¦

**å…‰çº¿çš„é‡æ–°å°„å‡º**ï¼š éƒ¨åˆ†å…‰çº¿åœ¨ç»è¿‡å¤šæ¬¡æ•£å°„åä¼šå›åˆ°ç‰©ä½“è¡¨é¢ï¼Œ_å¹¶ä»¥æ–°çš„æ–¹å‘å°„å‡º_ã€‚( BTDF)

<img
	src='/assets/Effects/3S/img2.png'
	alt='img2'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

**å…‰çº¿çš„ä¼ æ’­ä¸å’Œä¸åŒä»‹è´¨çš„äº¤äº’æ¨¡å‹**

| å±æ€§         | _BRDF_   | _BTDF_   |
| ------------ | -------- | -------- |
| **å®šä¹‰**     | è¡¨é¢åå°„ | è¡¨é¢é€å°„ |
| **å…‰å­¦ç°è±¡** | åå°„     | é€å°„     |

<img
	src='/assets/Effects/3S/img3.png'
	alt='img3'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

### å®ç°åŸç†

#### æ•ˆæœå…³é”®ç‚¹

> ğŸ“£ è™½ç„¶é€šè¿‡ç²¾å‡† BRDF + BSSRDF + BTDF çš„æ•°å­¦æ¨¡å‹æ¥æ¨¡æ‹Ÿ 3S çš„æ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯æ€§èƒ½æ¶ˆè€—å¤§

<img
	src='/assets/Effects/3S/img4.png'
	alt='img4'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

**åšåº¦**

å…‰çº¿åœ¨ç‰©ä½“å†…éƒ¨ä¼ æ’­ï¼Œä¼šå—åˆ°*ç‰©ä½“åšåº¦*çš„å½±å“

- åœ¨è¾ƒåšçš„åœ°æ–¹ï¼Œå…‰çº¿åœ¨å†…éƒ¨çš„è·¯å¾„æ›´é•¿ï¼Œèƒ½é‡ä¼šå› ä¸ºæ•£å°„å’Œå¸æ”¶è€Œé€æ¸è¡°å‡
- ç‰©ä½“åšåº¦å½±å“æ•£å°„åé€å‡ºçš„å…‰çš„é¢œè‰²ï¼ˆå› ä¸ºå…‰çš„å¸æ”¶é‡ä¸åŒï¼‰

**è§†è§’ä¸å…‰çº¿å…¥å°„è§’åº¦çš„å½±å“**

- éœ€è¦æœ‰ _view-dependent ä»¥åŠ light-dependent_ çš„æ¼«åå°„ä¸å…‰è¡°å‡ ï¼ˆè¦ä¸è§‚å¯Ÿæ–¹å‘ä»¥åŠå…‰çº¿æ–¹å‘æœ‰å…³ï¼‰

---

#### æ¨¡æ‹Ÿæ–¹æ³•

**~~èƒŒå…‰æ¨¡æ‹Ÿ~~**

**åŸç†**

<img
	src='/assets/Effects/3S/img5.png'
	alt='img5'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

- å¯¹äº translucent ææ–™æ¥è¯´ï¼Œä¸€ç›ç¯å…‰éœ€è¦è®¡ç®—ä¸¤ç§æ•ˆæœçš„å®ç°: æ­£é¢ç…§æ˜ï¼ˆå·¦ï¼‰& èƒŒé¢ç…§æ˜ï¼ˆå³ï¼‰

> ğŸ“£ **ä¸ºä»€ä¹ˆç”¨ -L æ¥æ¨¡æ‹Ÿæ•£å°„åçš„å‡ºå°„å…‰æ˜¯åˆç†çš„è¿‘ä¼¼ï¼Ÿ**
>
> å°½ç®¡æ•£å°„ä¼šéšæœºæ”¹å˜å…‰çº¿çš„æ–¹å‘ï¼Œä½†å¯¹äºå¤§å¤šæ•°åŠé€æ˜ææ–™æ¥è¯´æ•£å°„å…‰çº¿åœ¨ç»è¿‡å¤šæ¬¡æ•£å°„åï¼Œæ•´ä½“æ–¹å‘ä¼šåå‘å…‰æºçš„åŸå§‹æ–¹å‘ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸ºå‰å‘**æ•£å°„**ï¼Œæ˜¯è®¸å¤šææ–™ï¼ˆç‰¹åˆ«æ˜¯æœ‰æœºææ–™ï¼‰çš„ä¸€ç§å¸¸è§æ€§è´¨ã€‚

<img
	src='/assets/Effects/3S/img6.png'
	alt='img6'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

- è¡¨é¢ï¼ˆçº¢ç‚¹ï¼‰å¤„äºç‰©ä½“çš„èƒŒå…‰å¤„ï¼Œåº”è¯¥å—åˆ°-Lå…‰æºçš„å½±å“
- å½“è§‚æµ‹æ–¹å‘ä¸å…‰çº¿æ–¹å‘å¯¹é½ï¼ˆå³ï¼‰æ—¶ï¼Œåº”è¯¥èƒ½å¤Ÿçœ‹åˆ°èƒŒå…‰çš„æœ€å¤§æ•ˆæœã€‚å½“è§‚æµ‹æ–¹å‘ä¸å…‰çº¿æ–¹å‘å‚ç›´æ—¶ï¼ŒèƒŒå…‰æ•ˆæœåº”è¯¥æœ€å°

**å…¬å¼**

$$ V\cdot(-L) $$

- å½“è§‚å¯Ÿæ–¹å‘ä¸ $$-L $$å¯¹é½æ—¶ï¼Œå³è§‚å¯Ÿè€…ä¸å…‰æºä½äºç‰©ä½“ä¸¤ä¾§æ—¶ï¼Œæ•£å°„å…‰åº”è¯¥æ˜¯æœ€å®¹æ˜“åˆ°è¾¾è§‚å¯Ÿè€…çš„æƒ…å†µï¼Œè¿™ä¸ªæƒ…å†µä¸‹ç‚¹ç§¯ç»“æœæ˜¯ 1
- è¿™ç§æ–¹æ³•å¯ä»¥ç›´æ¥è¡¡é‡*è§‚å¯Ÿè€…å’Œå…‰æºæ–¹å‘æ˜¯å¦å¯¹ç§°*ï¼Œéå¸¸é€‚åˆç”¨äº*èƒŒå…‰æ¨¡æ‹Ÿ*

---

**~~æ³•çº¿æ‰°åŠ¨~~**

**åŸç†**

- é™¤äº†è€ƒè™‘è§†çº¿æ–¹å‘ä¸å…‰æºæ–¹å‘å¯¹èƒŒå…‰æ•ˆæœçš„å½±å“ï¼Œç‰©ä½“è¡¨é¢çš„æœå‘ï¼Œ_å³ç‰©ä½“çš„æ³•çº¿ä¹Ÿåº”è¯¥å¯¹å…‰çº¿ç©¿é€ç‰©ä½“åå°„å‡ºçš„è§’åº¦æœ‰æ‰€å½±å“_
- Subsurface distortion $$\delta $$
- _å‚æ•° $$\delta$$çš„ä½œç”¨æ˜¯ä½¿-Lå‘è¡¨é¢æ³•çº¿ N æ–¹å‘åç§»_ï¼Œæ§åˆ¶è¡¨é¢æ³•çº¿å¯¹å‡ºå°„å…‰çº¿çš„åç§»å¼ºåº¦

**å…¬å¼**

- $$I_{back} = V \cdot -normalize(L+N\delta)$$
  - å½“ $$\delta=0$$ï¼Œå¾—åˆ° $$I_{back} = V \cdot -L$$
  - å½“ $$\delta=1$$ï¼Œå¾—åˆ° $$I_{back} = V \cdot -normalize(L+N)$$å³ $$I_{back} = V \cdot -H$$
  - åŠç¨‹å‘é‡ $$H = (L + N)$$

<img
	src='/assets/Effects/3S/img7.png'
	alt='img7'
	style='width: 30%; height: auto; display:block; margin: 0 auto;'
/>

---

**~~å…‰æ•ˆæ§åˆ¶~~**

**å…¬å¼**

$$I_{back} = saturate(V \cdot-|L+N\delta|)^p \cdot s$$

- p æ§åˆ¶å…‰çš„é›†ä¸­åº¦å’Œé”åˆ©åº¦
- s æ§åˆ¶æ•´ä½“çš„å…‰å¼º

---

**~~åšåº¦æ¨¡æ‹Ÿ~~**

**åŸç†**

- èƒŒå…‰çš„å¼ºåº¦åº”è¯¥å—åˆ°ç‰©ä½“åšåº¦çš„å½±å“ï¼Œç†æƒ³æƒ…å†µä¸‹åº”è¯¥ç»§ç»­è¦çŸ¥é“å…‰çº¿Markdown Preview Enhancedåœ¨ç‰©ä½“å†…éƒ¨ä¼ æ’­çš„è·¯å¾„è·ç¦»ï¼Œå¹¶å°†è¿™ä¸ªè·ç¦»çº³å…¥åˆ°å…‰ç…§è¡°å‡çš„è€ƒè™‘ä¸­
- é€šè¿‡ä¸€å¼ è´´å›¾æ¥è®°å½•â€œç‰©ä½“åšåº¦â€ï¼Œå¹¶é€šè¿‡åšåº¦æ¥è¡¨ç¤ºå…‰åœ¨ç‰©ä½“å†…éƒ¨ä¼ æ’­è·¯å¾„çš„è·ç¦»é•¿çŸ­ - _Local Thickness Map_
- çœŸå®çš„å…‰åœ¨ç‰©ä½“å†…éƒ¨çš„è·¯å¾„é•¿åº¦ä¸å…‰æºçš„å…¥å°„æ–¹å‘æœ‰å…³ï¼Œæ‰€ä»¥è¿™ä¸ªâ€œç‰©ä½“çš„åšåº¦â€å…¶å®å–å†³äºå…‰çº¿çš„å…¥å°„è§’åº¦ã€‚æ‰€ä»¥é€šè¿‡Thickness mapæ¥æ¨¡æ‹Ÿåšåº¦å¹¶ä¸çœŸå®å‡†ç¡®ï¼Œä½†èƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šç»™å‡ºæ­£ç¡®çš„è§†è§‰æ•ˆæœ

**Local Thickness Map**

- é€šè¿‡ç¿»è½¬æ³•çº¿è®¡ç®—ç‰©ä½“ AO ï¼ˆNormal-inverted computation of ambient occlusionï¼‰æ¥æ¨¡æ‹Ÿåšåº¦ï¼Œå¹¶çƒ˜ç„™è¿™ä¸ªç‰¹æ®Šçš„ AO è´´å›¾
  - ç¿»è½¬ç‰©ä½“è¡¨é¢æ³•çº¿
  - æ¸²æŸ“ AO
  - ç¿»è½¬ AO è´´å›¾é¢œè‰²å¹¶å­˜å‚¨
- è¿™ä¸ª AO è´´å›¾ç”šè‡³å¯ä»¥ä¸å±€é™äºç°åº¦å›¾ï¼Œå¯ä»¥ç”¨äºå…‰çº¿ä»é€å°„ç©¿è¿‡ç‰©ä½“åå‘æ•£å‡ºæ¥çš„é¢œè‰²

> ğŸ“£ **ç¿»è½¬æ³•çº¿çƒ˜ç„™çš„ AO è´´å›¾**
>
> AO è´´å›¾ç”¨äºè¡¨ç¤ºç¯å¢ƒä¸­æœ‰å¤šå°‘å…‰èƒ½å¤Ÿåˆ°è¾¾è¡¨é¢ä¸Šçš„æŸä¸€ç‚¹ç¿»è½¬æ³•çº¿åçƒ˜ç„™çš„ AO è´´å›¾å¯ä»¥ç”¨äºè¡¨ç¤ºç‰©ä½“å†…éƒ¨çš„å…‰çº¿ä¼ æ’­æƒ…å†µ

<img
	src='/assets/Effects/3S/img9.png'
	alt='img9'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

### å…·ä½“å®ç°

#### 3Sæ•ˆæœå…¬å¼

> ğŸ“£ **3S = èƒŒå…‰ + æ³•çº¿æ‰°åŠ¨ + å…‰æ•ˆæ§åˆ¶ + åšåº¦æ¨¡æ‹Ÿ**

èƒŒå…‰ + æ³•çº¿æ‰°åŠ¨ï¼š$$I_{back} = saturate(V \cdot-|L+N\delta|)^p \cdot s$$

åšåº¦æ¨¡æ‹Ÿï¼šLocal Thickness map

---

#### URPç®¡çº¿ä¸‹çš„åŸºç¡€å®ç°

**èƒŒå…‰**

```c
  half4 frag(Varyings i) : SV_Target
  {
      half4 color;
      Light mainLight = GetMainLight();
      half3 N = normalize(i.normalWS);
      half3 L = mainLight.direction;
      half3 V = normalize(_WorldSpaceCameraPos - i.positionWS);
      half3 H = normalize(V + L);

      // èƒŒé¢å…‰ç…§ -----------------------------
      // dot(V, -L)
      half3 backLight = saturate(dot(V, -L));
      return float4(backLight,1);
  }
```

<LocalVideo src='/assets/Effects/3S/video1.mp4' alt='video1' />-
å½“è§†è§’ä¸å…‰çº¿å‚ç›´æ—¶ï¼Œçœ‹ä¸è§èƒŒå…‰æ•ˆæœã€‚å½“è§†è§’ä¸å…‰çº¿å¯¹é½æ—¶ï¼ŒèƒŒå…‰æ•ˆæœæœ€å¼º

---

**æ³•çº¿æ‰°åŠ¨**

```c
half4 frag(Varyings i) : SV_Target
{
    ...

    // èƒŒé¢å…‰ç…§ -----------------------------
    half3 halfNL = normalize(L + N * _Distortion);
    // dot(V, -H)
    half3 backLight = saturate(dot(V, -halfNL)); // dot(V, -|L + N * delta|)
    return float4(backLight,1);
}
```

<LocalVideo src='/assets/Effects/3S/video2.mp4' alt='video2' />

Normal Distortion = 0æ—¶ï¼Œå³æ— æ³•çº¿æ‰°åŠ¨ï¼Œç½‘æ ¼å—åˆ°èƒŒå…‰å½±å“ä½†æ˜¯æ³•çº¿å¯¹å‡ºå°„å…‰çš„æ–¹å‘æ— å¹²æ‰°ï¼Œç‰©ä½“ç¼ºå°‘ç»†èŠ‚ $$I_{back} = saturate(V \cdot-L)$$ - Normal Distortion = 1æ—¶ï¼Œæ³•çº¿æ‰°åŠ¨æœ€å¤§ï¼Œå‡ºå°„å…‰ä¼šå—åˆ°è¡¨é¢æ³•çº¿æ–¹å‘çš„å½±å“å¹¶å‘æ³•çº¿æ–¹å‘åç§» $$I_{back} = saturate(V \cdot-|L+N|)$$

---

**å…‰æ•ˆæ§åˆ¶**

$$ I\_{back} = saturate(V \cdot-|L+N\delta|)^p \cdot s $$

- p å…‰é›†ä¸­åº¦
- s å…‰å¼º

```c
half3 backLight = pow(saturate(dot(V, -halfNL)), _BackLightPower) * _BackLightIntensity;
```

<LocalVideo src='/assets/Effects/3S/video3.mp4' alt='video3' />

- Back Light Power æ§åˆ¶å…‰çš„é›†ä¸­
- Back Light Intensityæ§åˆ¶å…‰å¼º

---

**åŸºç¡€å…‰ç…§**

Diffuse + Specular

```c
half4 frag(Varyings i) : SV_Target
{
    half4 color;
    Light mainLight = GetMainLight();

    // æ­£é¢å…‰ç…§ -----------------------------
    // Lambert diffuse
    half3 albedo = tex2D(_MainTex, i.uv) * _Tint.rgb;
    half3 N = normalize(i.normalWS);
    half3 L = mainLight.direction;
    half3 diffuse = saturate(dot(N,L));
    diffuse *= mainLight.color * albedo; // diffuse = lightColor * albedo * NdotL

    // Blinn Phong specular
    // specular = (NdotH)^_Smoothness
    half3 V = _WorldSpaceCameraPos - i.positionWS;
    half3 H = normalize(V + L);
    half3 specular = pow(saturate(dot(N, H)), _Glossiness);
    specular *= mainLight.color * _SpecularColor;

    // combination
    color = float4(diffuse + specular,1);
    return color;
}
```

<LocalVideo src='/assets/Effects/3S/video4.mp4' alt='video4' />-
å½“å‰æ··åˆç»“æœï¼ˆåªæœ‰ä¸€ç›ä¸»å…‰æºï¼Œæ•´ä½“è¾ƒæš—ï¼‰

---

**åšåº¦è´´å›¾åˆ¶ä½œ**

<img
	src='/assets/Effects/3S/img10.png'
	alt='img10'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

- AOèŠ‚ç‚¹å‹¾é€‰Insideæ¥ç¿»è½¬çƒ˜ç„™æ—¶ç‰©ä½“çš„æ³•çº¿
- Invert Coloré¢œè‰²åç›¸
- å› ä¸ºç»è¿‡å¤„ç†åä»¥Emissionæè´¨è¾“å‡ºï¼Œæ‰€ä»¥çƒ˜ç„™ç±»å‹é€‰æ‹©Emitè€Œä¸æ˜¯AO

<img
	src='/assets/Effects/3S/img11.png'
	alt='img11'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

---

**åšåº¦æ¨¡æ‹Ÿ**

```c
TEXTURE2D(_ThicknessTex);
SAMPLER(sampler_ThicknessTex);
```

```c
// èƒŒé¢å…‰ç…§ -----------------------------
half3 backLight = pow(saturate(dot(V, -halfNL)), _BackLightPower) * _BackLightIntensity; // dot(V, -H)
half thickness = SAMPLE_TEXTURE2D(_ThicknessTex, sampler_ThicknessTex, i.uv); // é‡‡æ ·åšåº¦è´´å›¾
backLight *= thickness;
backLight *= mainLight.color;
return float4(backLight,1);
```

<img
	src='/assets/Effects/3S/img12.png'
	alt='img12'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

### ç›¸å…³èµ„æº

GDC 2011 - Approximating Translucency for a Fast, Cheap and Convincing Subsurface-Scattering Look

- https://www.ea.com/frostbite/news/approximating-translucency-for-a-fast-cheap-and-convincing-subsurface-scattering-look
- https://www.youtube.com/watch?v=MuIC9tX2Fmo

Fast Subsurface Scattering in Unity

- https://www.alanzucconi.com/2017/08/30/fast-subsurface-scattering-1/
- https://www.alanzucconi.com/2017/08/30/fast-subsurface-scattering-2/

å¿«é€Ÿæ¬¡è¡¨é¢æ•£å°„çš„åŸç†ä¸å®ç°

- https://www.bilibili.com/video/BV1FP4y1c7tY/?spm_id_from=333.337.top_right_bar_window_history.content.click&vd_source=12155d6952f8b14a857fc371d5743944

SIGGRAPH 2008 - Real-Time Translucent Rendering Using GPU-based Texture Space Importance Sampling

- https://people.cs.nycu.edu.tw/~wclin/translucency.html
- SIGGRAPH_2008_Realtime Translucency Rendering.pdf

ä½¿ç”¨ç¿»è½¬æ³•çº¿å’Œ AO çƒ˜ç„™è·å¾—æ¨¡å‹åšåº¦

- [Maya] https://zhuanlan.zhihu.com/p/521955808
- [Blender] https://www.bilibili.com/video/BV1tC41187ka/?spm_id_from=333.337.search-card.all.click&vd_source=12155d6952f8b14a857fc371d5743944
