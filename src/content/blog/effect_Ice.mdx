---
heroImage: /src/assets/images/cover_ice.png
category: å®è·µè®°å½•
description: Unity URP ç®¡çº¿ä¸‹å®ç°åŸºäº Raymarching çš„å†°å—æè´¨å®ç°
pubDate: 2025-02-26T16:00:00.000Z
tags:
  - æ¸²æŸ“æ•ˆæœ
title: å†°å—æè´¨
---

import LocalVideo from '../../components/LocalVideo.astro'

<LocalVideo src='/assets/Effects/Ice/video1.mp4' alt='video1' />

### å…‰çº¿åˆ†æ

#### æ¸²æŸ“æ–¹ç¨‹

**~~è®¡ç®—æ¸²æŸ“ç‚¹åˆ°è§‚æµ‹è€…çš„å…‰çº¿è¾å°„ç‡ Radiance~~**

è®¡ç®—èƒ½å¤Ÿåˆ°è¾¾è§‚å¯Ÿè€…çœ¼ç›çš„Radiance

<img
	src='/assets/Effects/Ice/img2.png'
	alt='img2'
	style='width: 80%; height: auto; display:block; margin: 0 auto;'
/>

---

å…‰çº¿å°„å‘æ¸²æŸ“ç‚¹ç„¶åå‡ºå°„åˆ°è§‚æµ‹è€…çœ¼ç›

<img
	src='/assets/Effects/Ice/img1.png'
	alt='img1'
	style='width: 80%; height: auto; display:block; margin: 0 auto;'
/>

---

**æ¸²æŸ“æ–¹ç¨‹çš„å…³é”®æ˜¯è®¡ç®—æ¸²æŸ“ç‚¹åˆ°è§‚å¯Ÿè€…çš„ Radiance**

- å‡è®¾ _åªæœ‰ä¸€ä¸ªç†æƒ³ç‚¹å…‰æº_ ï¼Œä¸”ç¯å¢ƒä¸ºä¸€ç‰‡æ¼†é»‘

<img
	src='/assets/Effects/Ice/img3.png'
	alt='img3'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

---

**BRDF åŒå‘åå°„åˆ†å¸ƒå‡½æ•°**

<img
	src='/assets/Effects/Ice/img4.png'
	alt='img4'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

æ ¹æ®èƒ½é‡å®ˆæ’æ³•åˆ™ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ $$Lo(p,Ï‰o)$$ ï¼Œ_æœ€å¤§å€¼æ˜¯ $$Li(p,Ï‰i)(NÂ·Ï‰i)$$_ ï¼Œè¿™æ˜¯é•œé¢åå°„çŠ¶æ€å¹¶ä¸”å…‰çº¿å®Œå…¨æ²¡æœ‰è¢«å¸æ”¶å’ŒæŠ˜å°„çš„æƒ…å†µï¼Œå› æ­¤BRDFçš„å€¼ä¼šåœ¨[0,1]ä¹‹é—´ã€‚æ ¹æ®ä¸åŒçš„ç‰©è´¨å±æ€§ï¼Œå…‰çº¿åˆ°è¾¾è¡¨é¢ä¼šæœ‰ä¸åŒæƒ…å†µçš„åå°„ã€æŠ˜å°„ã€æ•£å°„å’Œå¸æ”¶ï¼Œåå°„å‡ºæ¥çš„å…‰çº¿ä¼šæœ‰ä¸åŒç¨‹åº¦çš„æŸå¤±ï¼Œè€ŒBRDFé€šå¸¸å°±æ˜¯æˆ‘ä»¬é€šä¿—ä¸Šè®²çš„æè´¨ã€‚

<br></br>
**~~å¤šå…‰æºæƒ…å†µä¸‹è®¡ç®— Radiance~~**

<img
	src='/assets/Effects/Ice/img5.png'
	alt='img5'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

<img
	src='/assets/Effects/Ice/img6.png'
	alt='img6'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>
**~~æ¸²æŸ“æ–¹ç¨‹å®Œå…¨ä½“~~**

<img
	src='/assets/Effects/Ice/img7.png'
	alt='img7'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

ç°å®ç¯å¢ƒçš„å…‰æºç”±äºé›†æˆäº†å¤šå…‰æºã€ç‰©ä½“ä¹‹é—´ç›¸äº’åå¼¹çš„é—´æ¥å…‰ç­‰æƒ…å†µï¼Œæ‰€ä»¥æ•´ä½“å…‰æºå¯ä»¥è®¤ä¸ºæ˜¯è¡¨é¢æ³•çº¿åŠçƒæ–¹å‘ä¸Šæœ‰æ— é™ä¸ªè¿ç»­çš„ç‚¹å…‰æºã€‚æ­¤æ—¶è®¡ç®—è¿ç»­ç‚¹å…‰æºçš„ Radiance ç”¨åˆ°ç§¯åˆ†ã€‚

- ä» pç‚¹åå°„åè¿›å…¥è§‚æµ‹è€…çœ¼ç›çš„Radianceå°±æ˜¯ _æ‰€æœ‰åŠçƒæ–¹å‘Ï‰içš„å®šç§¯åˆ†_
- å† _åŠ ä¸Šç‰©ä½“è‡ªèº«çš„è‡ªå‘å…‰è¾å°„å‡ºçš„å…‰çº¿_

<br></br>
#### å†°å—æè´¨çš„å…‰çº¿åˆ†æ

**~~å…‰çº¿å¯é€†æ€§è´¨ä¸å…‰çº¿è¿½è¸ª~~**

æ ¹æ®å…‰çº¿çš„å¯é€†æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º _å…‰çº¿æ˜¯ä»è§‚æµ‹è€…çœ¼ç›å°„å‡º_ ï¼Œç„¶åæŠŠèƒ½åˆ°è¾¾çš„æ‰€æœ‰æ–¹å‘ä¸Šçš„å…‰æºåšä¸€ä¸ªç›¸åŠ æˆ–ç§¯åˆ†æ“ä½œï¼Œå…¶å®è¿™æ€è·¯æ­£æ˜¯å…‰çº¿è¿½è¸ªçš„åŸºæœ¬æ€è·¯ã€‚

<br></br>
**~~å†°æè´¨å—å…‰åˆ†æ~~**

å†°å—æè´¨çš„å…‰çº¿ï¼ˆå‡è®¾è¡¨é¢å…‰æ»‘ï¼‰

- _è¡¨é¢åå°„_
- _è¡¨é¢æŠ˜å°„_
- _å†…éƒ¨æ•£å°„_ ï¼š å†°å—é‡Œé¢çš„æ‚è´¨ï¼ˆæ°”æ³¡ã€è£‚ç¼ã€å°˜ç²’ç­‰ï¼‰ï¼Œä¼šæŠŠå…‰çº¿æ‰“æ•£ï¼Œæ•£å°„åˆ°å‘¨å›´çš„ç¯å¢ƒä¸­å»ï¼Œæ‰€ä»¥å†°å—ä¸­é—´æ˜¯å­˜åœ¨å¾ˆå¤šå¤æ‚çš„æ•£å°„ç°è±¡

---

**BSDF**

å†°å—çš„å…‰çº¿æ¨¡å‹åˆ†æï¼Œå‡è®¾å†°å—ä¸­çš„æ‚è´¨æ˜¯å‡åŒ€åˆ†å¸ƒçš„

<img
	src='/assets/Effects/Ice/img8.png'
	alt='img8'
	style='width: 50%; height: auto; display:block; margin: 0 auto;'
/>

- å‡è®¾å…‰çº¿ä»è§‚æµ‹è€…å°„å‡ºï¼Œ _å…¥å°„å…‰çº¿Ï‰içš„èƒ½é‡ä¼šåˆ†æ•£åˆ°åå°„æ–¹å‘ï¼ˆÏ‰refleï¼‰ã€æŠ˜å°„æ–¹å‘ï¼ˆÏ‰refraï¼‰ã€æ•£å°„æ–¹å‘ï¼ˆÏ‰dï¼‰_ ï¼Œå› æ­¤æ€è·¯æ˜¯æˆ‘ä»¬ç‹¬ç«‹å»è®¡ç®—åå°„ã€æŠ˜å°„å’Œæ•£å°„æ–¹å‘çš„èƒ½é‡ï¼Œå†æŠŠå®ƒä»¬åŠ èµ·æ¥å°±è¡Œã€‚

- ç ”ç©¶æŠ˜å°„é—®é¢˜ï¼Œå°±å¿…é¡»åŠ ä¸ŠBTDFï¼ˆåŒå‘é€å°„åˆ†å¸ƒå‡½æ•°ï¼‰ï¼ŒBRDFå’ŒBTDFåŠ èµ·æ¥ç»Ÿç§°ä¸ºBSDF

<br></br>
**~~å†°æè´¨å…‰çº¿æ¨¡æ‹Ÿæ€è·¯~~**

**åå°„ä¸æŠ˜å°„**

- é€šè¿‡ Cube Map è¿›è¡Œåå°„æ–¹å‘ä¸æŠ˜å°„æ–¹å‘çš„é‡‡æ ·

---

**æ•£å°„**

- æ•£å°„æ¶‰åŠåˆ°ä½“ç§¯é—®é¢˜ï¼Œç”¨ç‰©ä½“åšåº¦çš„æ€è·¯æ¥æ¨¡æ‹Ÿã€‚è–„çš„åœ°æ–¹æ•£å°„èƒ½é‡å¼±ï¼Œåšçš„åœ°æ–¹æ•£å°„èƒ½é‡å¼ºã€‚
- æ•£å°„èƒ½é‡ç”¨ç¯å¢ƒå…‰çš„å¹³å‡é¢œè‰²æ¥æ¨¡æ‹Ÿã€‚

<br></br>
### Shader åŸºæœ¬æ¡†æ¶ #### åŸºç¡€ URP Unlit Shader

Shader structure

```csharp
Shader "Unlit/Ice"
{
    Properties
    {

    }
    SubShader
    {
        Tags { "RenderType"="Opaque" "RenderPipeline" = "UniversalPipeline" "Queue" = "Geometry"}

        Pass
        {
            Name "Unlit"

            HLSLPROGRAM
            //This directive tells the shader compiler to exclude certain graphics APIs when compiling this shader. Specifically:
            // gles: Excludes OpenGL ES 2.0 (commonly used on older mobile devices).
            // gles3: Excludes OpenGL ES 3.0 (used on newer mobile devices).
            // glcore: Excludes desktop OpenGL.
            #pragma exclude_renderers gles gles3 glcore
            #pragma target 4.5

            #pragma vertex UnlitPassVertex
            #pragma fragment UnlitPassFragment

            #include "IceInput.hlsl"
            #include "IceForwardPass.hlsl"

            ENDHLSL
        }
    }
}

```

Inputs

```csharp
#include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/SurfaceInput.hlsl"

// å®šä¹‰ C Buffer
// C Bufferç”¨äºå°†ä¸€äº›ç»å¸¸å˜åŒ–çš„å…¨å±€å˜é‡ï¼ˆå¦‚æè´¨å±æ€§ï¼‰ä»CPUä¼ é€’åˆ°GPU
// **UnityPerMaterial**æ˜¯è¯¥ç¼“å†²åŒºçš„åå­—ï¼Œè¡¨ç¤ºä¸æè´¨ç›¸å…³çš„å‚æ•°é€šå¸¸å­˜å‚¨åœ¨è¿™é‡Œ
CBUFFER_START(UnityPerMaterial)

CBUFFER_END
```

Pass

```csharp
// å®šä¹‰å®šç‚¹å±æ€§çš„ç»“æ„ä½“ï¼Œä¼ å…¥é¡¶ç‚¹ç€è‰²å™¨
struct Attributes
{
    float4 positionOS : POSITION;
};

// å®šä¹‰ä»é¡¶ç‚¹ç€è‰²å™¨ä¼ é€’åˆ°ç‰‡å…ƒç€è‰²å™¨çš„æ•°æ®ç»“æ„ä½“
struct Varyings
{
    float4 positionCS  : SV_POSITION;
};

// vertex shader
Varyings UnlitPassVertex(Attributes input)
{
    Varyings output = (Varyings)0;

    // å‡½æ•° GetVertexPositionInputs(input.positionOS.xyz) å°†é¡¶ç‚¹ä»Object-Spaceè½¬æ¢åˆ°Clip-space
    VertexPositionInputs vertexInput = GetVertexPositionInputs(input.positionOS.xyz);
    output.positionCS = vertexInput.positionCS;
    return output;
}

// fragment shader
half4 UnlitPassFragment(Varyings input) : SV_Target
{
    return half4(1,1,1,1);
}
```

<br></br>
#### ç»†åŒ– InputData

<details>
	<summary>ç»†åŒ–ä»£ç </summary>

    ```csharp
    struct IceInputData
    {
    	// å½“å‰ç›¸æœºçš„ä¸–ç•Œç©ºé—´ä½ç½®
    	float3 cameraPosition;
    	// æ¨¡å‹è¡¨é¢ç€è‰²ç‚¹çš„ä¸–ç•Œç©ºé—´ä½ç½®
    	float3 positionWS;
    	// ä¸–ç•Œç©ºé—´çš„è§†è§‰æ–¹å‘ï¼Œæ¨¡å‹ç€è‰²ç‚¹æŒ‡å‘ç›¸æœºçš„æ–¹å‘
    	float3 viewDirectionWS;
    	// åˆ‡çº¿ç©ºé—´çš„è§†è§‰æ–¹å‘ï¼Œæ˜¯viewDirectionWSçš„ä¸åŒç©ºé—´æè¿°
    	float3 viewDirectionTS;

    	// ------------éœ€è¦ä¸‰ä¸ªæ³•çº¿æ–¹å‘------------
    	// 1. ä¸–ç•Œç©ºé—´çš„é¡¶ç‚¹æ³•çº¿æ–¹å‘ï¼šï¼ˆé¡¶ç‚¹æ³•çº¿ï¼‰ç”¨äºè®¡ç®—ç‰©ä½“åšåº¦
    	float3 vertexNormalWS;
    	// 2. ä¸–ç•Œç©ºé—´çš„åƒç´ æ³•çº¿æ–¹å‘ï¼ˆåŒ…å«æ³•çº¿è´´å›¾ä¿¡æ¯ï¼‰ï¼šç²¾åº¦è¾ƒé«˜ï¼Œç”¨äºè®¡ç®—åå°„å’ŒæŠ˜å°„
    	float3 pixelNormalWS;
    	// 3. åˆ‡çº¿ç©ºé—´çš„æ³•çº¿æ–¹å‘ï¼šï¼ˆæ³•çº¿è´´å›¾ä¸Šçš„ä¿¡æ¯ï¼‰ï¼Œè®¡ç®—è£‚ç¼çš„æ—¶å€™éœ€è¦é‡‡æ ·SDFå›¾ï¼Œè€Œè¿™éƒ¨åˆ†è®¡ç®—æ˜¯åœ¨åˆ‡çº¿ç©ºé—´å®Œæˆ
    	float3 normalTS;


    	// ç³»ç»Ÿçš„è¿è¡Œæ—¶é—´
    	float time;
    };
    ```

    ```csharp
    // å¯¹æœ‰detail normal mapè¿™æ ·æœ‰ç¬¬äºŒä¸ªæ³•çº¿è´´å›¾çš„æƒ…å†µè¿›è¡Œæ³•çº¿æ··åˆ

half3 BlendAngleCorrectedNormals(half3 baseNormal, half3 additionalNormal)
{
baseNormal.b += 1.0;
additionalNormal.rg _= -1.0;
half d = dot(baseNormal, additionalNormal);
half3 tempBase = baseNormal _ d;
half3 tempAdd = additionalNormal \* baseNormal.b;
return tempBase - tempAdd;
}

// è®¡ç®—ä¸–ç•Œç©ºé—´ä¸‹çš„é€åƒç´ æ³•çº¿
// é‡‡æ ·æ³•çº¿è´´å›¾çš„åˆ°åˆ‡çº¿ç©ºé—´ä¸‹çš„é€åƒç´ æ³•çº¿å¹¶å°†å…¶å½’ä¸€åŒ–
// å¯¹æœ‰detail normalçš„æƒ…å†µè¿›è¡Œæ³•çº¿æ··åˆ
// å°†åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿è½¬æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸‹
void EffectNormal(float3x3 t2w, float2 uv, out half3 normalTS, out half3 normalWS)
{
normalTS = half3(0, 0, 1);

    #ifdef _USEGLASSNORMAL

    normalTS = UnpackNormal(tex2D(_GlassNormal, uv));
    normalTS.rg *= _GlassNormalScale;
    normalTS = normalize(normalTS);

    #ifdef _USEDETAILNORMAL
    half3 detailNormalTS = UnpackNormal(tex2D(_DetailNormal, uv * _GlassDetailUVScale));
    normalTS = BlendAngleCorrectedNormals(normalTS, detailNormalTS);
    normalTS = normalize(normalTS);
    #endif // _USEDETAILNORMAL

    #endif // _USEGLASSNORMAL

    normalWS = TransformTangentToWorld(normalTS, t2w);

}

// Varyings input å˜é‡ä¸ºç»è¿‡é¡¶ç‚¹ç€è‰²å™¨è®¡ç®—åè¾“å‡ºçš„å˜é‡
void InitializeIceData(Varyings input, out IceInputData inputData)
{
inputData = (IceInputData)0;

    // åˆ‡çº¿ç©ºé—´åˆ°ä¸–ç•Œç©ºé—´çš„è½¬æ¢çŸ©é˜µ
    // ç”±äºæ¯ä¸ªé¡¶ç‚¹çš„åˆ‡çº¿åæ ‡ä¸ä¸€æ ·ï¼Œå› æ­¤æ— æ³•é€šè¿‡Unityç»Ÿä¸€ä¼ é€’è¿‡æ¥ï¼Œéœ€è¦æ¯ä¸ªé¡¶ç‚¹å»è®¡ç®—
    float3x3 t2w = float3x3(input.tangentWS.xyz, input.bitangentWS.xyz, input.normalWS.xyz);

    // è·å–å½“å‰ç›¸æœºçš„ä¸–ç•Œç©ºé—´ä½ç½®
    inputData.cameraPosition = GetCameraPositionWS();
    // è·å–æ¨¡å‹è¡¨é¢ç€è‰²ç‚¹çš„ä¸–ç•Œç©ºé—´ä½ç½®
    inputData.positionWS = input.positionWS;

    // è·å–ä¸–ç•Œç©ºé—´çš„è§‚æµ‹æ–¹å‘ï¼ˆå½’ä¸€åŒ–ï¼‰
    // ä¸–ç•Œç©ºé—´ä¸‹çš„è§‚æµ‹æ–¹å‘åœ¨é¡¶ç‚¹ç€è‰²å™¨å·²ç»è®¡ç®—å‡ºæ¥å¹¶å‚¨å­˜åœ¨äº†æ³•çº¿ã€åˆ‡çº¿å’Œå‰¯åˆ‡çº¿çš„wåˆ†é‡ä¸Š
    inputData.viewDirectionWS = normalize(float3(input.normalWS.w, input.tangentWS.w, input.bitangentWS.w));

    // è·å–åˆ‡çº¿ç©ºé—´ä¸‹çš„è§‚æµ‹æ–¹å‘
    inputData.viewDirectionTS = TransformWorldToTangent(inputData.viewDirectionWS, t2w);

    // è·å–ä¸–ç•Œç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘ï¼ˆå½’ä¸€åŒ–ï¼‰
    inputData.vertexNormalWS = normalize(input.normalWS.xyz);

    // è¿™ä¸ªå‡½æ•°çš„ç›®çš„æ˜¯è®¡ç®—æ¨¡å‹çš„é€åƒç´ æ³•çº¿ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸–ç•Œç©ºé—´æ³•çº¿ã€‚
    // åˆ†ä¸ºåˆ‡çº¿ç©ºé—´æ³•çº¿ (normalTS) å’Œä¸–ç•Œç©ºé—´æ³•çº¿ (normalWS)ã€‚
    EffectNormal(t2w, input.uv0.zw, inputData.normalTS, inputData.pixelNormalWS);

    // _Timeæ˜¯Unityä¼ é€’è¿‡æ¥çš„æ—¶é—´å‚æ•°ï¼Œx:t/20 y:t z:t*2 w:t*3
    inputData.time = _Time.x;

}

````

</details>

<br></br>
### åå°„

#### CubeMap

**~~CubeMap åŸºç¡€ä»‹ç»~~**

CubeMapæ˜¯ä¸€å¼ ç”±6ä¸ªé¢ç»„æˆçš„çº¹ç†å›¾ï¼Œå®ƒå°†6ä¸ªçº¹ç†ç»„åˆæˆä¸€å¼ å•ä¸€çš„çº¹ç†ï¼Œå› æ­¤CubeMapæœ¬è´¨ä¸Šæ˜¯å±äºTexture2Dï¼Œåªæ˜¯ _é‡‡æ ·æ–¹å¼ä¸Texture2Dä¸åŒ_ ï¼ŒCubeMapå’ŒTexture3Dæ˜¯éœ€è¦åŒºåˆ†å¼€æ¥ï¼Œè™½ç„¶CubeMapå’ŒTexture3Déƒ½éœ€è¦ç”¨ä¸‰ç»´å‘é‡æ¥é‡‡æ ·ã€‚

<img
	src='/assets/Effects/Ice/img9.png'
	alt='img9'
	style='width: 60%; height: auto; display:block; margin: 0 auto;'
/>

---

å®é™…ä½¿ç”¨ä¸­ï¼Œç›¸å½“äºæŠŠCubeMapæŠ˜å æˆä¸€ä¸ªç«‹æ–¹ä½“ï¼Œç”»é¢æœå‘é‡Œé¢ï¼Œæ‘„åƒæœºæ‘†åœ¨ç«‹æ–¹ä½“çš„æ­£ä¸­é—´ï¼Œé€šè¿‡ `view direction` æ¥å¯¹CubeMapç´¢å¼•å’Œé‡‡æ ·ã€‚

<img
	src='/assets/Effects/Ice/img10.png'
	alt='img10'
	style='width: 60%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>
**~~CubeMap é‡‡æ ·æ–¹å¼~~**

ä½œä¸ºåå°„çš„é‡‡æ ·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ‰¾å‡º _åå°„æ–¹å‘_ ï¼Œé€šè¿‡åå°„æ–¹å‘æ¥åšç´¢å¼•é‡‡æ ·ï¼Œå°±èƒ½è·å¾—åå°„çš„æ•ˆæœã€‚

<img
	src='/assets/Effects/Ice/img11.png'
	alt='img11'
	style='width: 60%; height: auto; display:block; margin: 0 auto;'
/>

#### åå°„æ–¹å‘çš„è®¡ç®—

**~~åå°„æ–¹å‘åˆ†æ~~**

åå°„åˆ†æ

<img
	src='/assets/Effects/Ice/img12.png'
	alt='img12'
	style='width: 80%; height: auto; display:block; margin: 0 auto;'
/>

<img
	src='/assets/Effects/Ice/img13.png'
	alt='img13'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

- è®¡ç®—å‡º R åï¼Œç”¨å½’ä¸€åŒ–çš„ R è¿›è¡Œ CubeMap ç´¢å¼•é‡‡æ ·

<br></br>
**~~ä»£ç å®ç°~~**

```csharp
half4 EffectReflection(IceInputData inputData)
{
    // å…¥å°„æ–¹å‘ï¼ˆä¸–ç•Œç©ºé—´ä¸‹çš„è§‚æµ‹æ–¹å‘ï¼‰
    half3 inputDir = -inputData.viewDirectionWS;
    // ä¸–ç•Œç©ºé—´ä¸‹çš„åå°„æ–¹å‘ R =  2 * (dot(-L, N) * N) + L
    half3 refDir = dot(-inputDir, inputData.vertexNormalWS) * inputData.vertexNormalWS;
    refDir = 2 * refDir + inputDir;
    // é‡‡æ ·CubeMap
    half4 color = texCUBE(_ReflectionTexture, refDir);

    return color;
}
````

- ä½¿ç”¨å†…ç½® `reflect()` å‡½æ•°

```csharp
half4 EffectReflection(IceInputData inputData)
{
    half4 color = texCUBE(_ReflectionTexture, reflect(-inputData.viewDirectionWS, inputData.pixelNormalWS));

    return color;
}
```

<br></br>

#### åå°„ BRDF çš„è®¡ç®—

<img
	src='/assets/Effects/Ice/img14.png'
	alt='img14'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>
**~~è²æ¶…å°”å…¬å¼~~**

å¯¹äºå†°å—çš„åå°„ï¼Œæˆ‘ä»¬è®¤ä¸ºæ˜¯é•œé¢åå°„ï¼Œä¸å­˜åœ¨Glossyåå°„ï¼Œé‚£ä¹ˆBRDFé¡¹æˆ‘ä»¬å•çº¯è€ƒè™‘å…‰çº¿åœ¨ä¸¤ç§ä»‹è´¨ä¸­ä¼ æ’­æ—¶åå°„å’ŒæŠ˜å°„çš„è§„å¾‹å°±å¯ä»¥äº†ï¼Œè€Œæè¿°è¿™ä¸ªè§„å¾‹çš„å…¬å¼å°±æ˜¯è²æ¶…å°”å…¬å¼ã€‚

---

åå°„å…‰çš„æ–¹å‘æ€§ï¼š- é•œé¢åå°„ï¼šå…‰çº¿ä¸¥æ ¼æŒ‰ç…§å…¥å°„è§’ç­‰äºåå°„è§’çš„æ–¹å‘åå°„ï¼Œåå°„é«˜åº¦é›†ä¸­ã€‚- Glossyåå°„ï¼šå…‰çº¿ä¸»è¦é›†ä¸­åœ¨åå°„è§’é™„è¿‘ï¼Œä½†æœ‰ä¸€å®šçš„æ•£å°„èŒƒå›´ï¼Œåå°„å›¾åƒè¾ƒæ¨¡ç³Šã€‚

è¡¨é¢å…‰æ»‘åº¦ï¼š- é•œé¢åå°„ï¼šå‘ç”Ÿåœ¨éå¸¸å…‰æ»‘çš„è¡¨é¢ã€‚- Glossyåå°„ï¼šå‘ç”Ÿåœ¨æœ‰ä¸€å®šç²—ç³™åº¦çš„è¡¨é¢ã€‚

è§†è§‰æ•ˆæœï¼š- é•œé¢åå°„ï¼šåå°„å…‰çº¿éå¸¸æ¸…æ™°ï¼Œåå°„æ•ˆæœæ¥è¿‘é•œå­ã€‚- Glossyåå°„ï¼šåå°„å…‰çº¿ç¨å¾®æ•£å¼€ï¼Œåå°„æ•ˆæœæœ‰å…‰æ³½ï¼Œä½†å›¾åƒæ¨¡ç³Šã€‚

ä¾‹å­ï¼š- é•œé¢åå°„ï¼šé•œå­ã€æŠ›å…‰é‡‘å±ã€å…‰æ»‘çš„å†°å—ã€æ¸…æ¾ˆçš„æ°´é¢ã€‚- Glossyåå°„ï¼šå“‘å…‰è½¦æ¼†ã€æŠ›å…‰ä½†ç•¥å¾®ç²—ç³™çš„æœ¨æã€è½»åº¦ç£¨ç ‚é‡‘å±ã€‚

---

è²æ¶…å°”å…¬å¼æè¿°åå°„ä¸é€å°„

- _è²æ¶…å°”å…¬å¼æè¿°äº†å…‰åœ¨ä¸¤ç§ä»‹è´¨äº¤ç•Œå¤„çš„åå°„å’ŒæŠ˜å°„è¡Œä¸º_ ï¼Œå³å…‰ä»ä¸€ç§ä»‹è´¨ï¼ˆä¾‹å¦‚ç©ºæ°”ï¼‰è¿›å…¥å¦ä¸€ç§ä»‹è´¨ï¼ˆä¾‹å¦‚å†°å—ï¼‰æ—¶ï¼Œéƒ¨åˆ†å…‰ä¼šè¢«åå°„ï¼Œéƒ¨åˆ†å…‰ä¼šé€å°„è¿›å…¥å†°å—å†…éƒ¨ã€‚åå°„ç‡å’Œé€å°„ç‡ç”±è²æ¶…å°”æ–¹ç¨‹è®¡ç®—ï¼Œå…·ä½“å–å†³äºå…¥å°„å…‰çš„è§’åº¦å’Œä¸¤ç§ä»‹è´¨çš„æŠ˜å°„ç‡ã€‚

---

BRDF çš„ç®€åŒ–å¤„ç†

- BRDF æ˜¯æè¿°ç‰©ä½“è¡¨é¢å…‰çº¿åå°„è¡Œä¸ºçš„ä¸€ä¸ªå¹¿ä¹‰æ¨¡å‹ã€‚_å¯¹äºå†°å—è¿™ç§é«˜åº¦å…‰æ»‘çš„è¡¨é¢ï¼Œå…‰çº¿åå°„è¡¨ç°ä¸ºçº¯é•œé¢åå°„_ ï¼Œå› æ­¤ BRDF å¯ä»¥ç®€åŒ–ä¸ºå•çº¯è€ƒè™‘å…‰åœ¨ä¸åŒä»‹è´¨é—´ä¼ æ’­æ—¶çš„åå°„å’ŒæŠ˜å°„è§„å¾‹ï¼Œå³é€šè¿‡è²æ¶…å°”å…¬å¼æ¥è®¡ç®—ã€‚
- ç”±äºå†°å—è¡¨é¢æ²¡æœ‰æ˜¾è‘—çš„è¡¨é¢ç²—ç³™åº¦æˆ–å¾®è§‚ç»“æ„ï¼Œä¸éœ€è¦è€ƒè™‘å¤æ‚çš„å…‰æ³½åå°„æˆ–æ•£å°„æ¨¡å‹ï¼Œå› æ­¤ BRDF å¯ä»¥ç®€åŒ–ä¸ºç”±è²æ¶…å°”å…¬å¼å†³å®šçš„é•œé¢åå°„ã€‚

---

è²æ¶…å°”å…¬å¼

<img
	src='/assets/Effects/Ice/img15.png'
	alt='img15'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>
**~~ä»£ç å®ç°~~**

```csharp
half4 EffectReflection(IceInputData inputData)
{
    // é‡‡æ ·cubeMap
    half4 color = texCUBE(_ReflectionTexture, reflect(-inputData.viewDirectionWS, inputData.pixelNormalWS));

    // è²å°¼å°”é¡¹Fresnel
    // ((n1 - n2)/(n1 + n2))^2ï¼Œn1æ˜¯ç©ºæ°”çš„æŠ˜å°„ç‡1.0ï¼Œn2æ˜¯å†°çš„æŠ˜å°„ç‡1.333
    half R0 = 0.02;
    // cosÎ¸ï¼Œå¯ä»¥è½¬æ¢æˆå‡ºå°„æ–¹å‘ä¸æ³•çº¿æ–¹å‘çš„ç‚¹ä¹˜
    half fresnel = dot(inputData.viewDirectionWS, inputData.pixelNormalWS);
    fresnel = 1 - max(0, fresnel);
    fresnel = pow(fresnel, 5);
    fresnel = R0 + (1 - R0) * fresnel;

    // _ReflectionColor æ˜¯ç”¨æ¥æ¨¡æ‹Ÿå…‰çº¿å¸æ”¶
    color.rgb *= fresnel * _ReflectionColor.rgb;
    color.a = fresnel;
    return color;
}
```

`_ReflectionColor` æ˜¯ä¸€ä¸ªæè´¨å±æ€§ï¼Œå®ƒè¡¨ç¤ºåå°„å…‰çš„é¢œè‰²ï¼Œå¯èƒ½æ˜¯æ ¹æ®å…‰çš„å¸æ”¶æƒ…å†µè¿›è¡Œè°ƒæ•´çš„

- å¦‚æœ `_ReflectionColor` æ˜¯æ·±è‰²ï¼ˆæ¯”å¦‚é»‘è‰²ï¼‰ï¼Œåˆ™æ¨¡æ‹Ÿå¼ºçƒˆçš„å…‰çº¿å¸æ”¶ï¼Œåå°„å…‰çš„é¢œè‰²ä¼šå˜å¾—æš—æ·¡ã€‚
- å¦‚æœ `_ReflectionColor` æ˜¯è¾ƒäº®çš„é¢œè‰²ï¼Œåˆ™è¡¨é¢å¸æ”¶è¾ƒå°‘ï¼Œæ›´å¤šçš„å…‰è¢«åå°„å‡ºæ¥ã€‚

<br></br>
**~~ä¸å®Œæ•´ BRDF çš„åŒºåˆ«~~**

ä¸Šè¿°æ–¹æ³•ä¸­ä½¿ç”¨äº†è²æ¶…å°”å…¬å¼ä¸­çš„ _Schlick è¿‘ä¼¼_ æ¥è®¡ç®— _åå°„ç‡_ ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç®€åŒ–å¤„ç†ï¼Œç”¨äºé«˜æ•ˆè®¡ç®—å…‰çº¿åœ¨æè´¨è¡¨é¢ä¸Šçš„åå°„ã€‚Schlick è¿‘ä¼¼èƒ½å¤Ÿå¿«é€Ÿé€¼è¿‘çœŸå®çš„è²æ¶…å°”åå°„ç‡è®¡ç®—ï¼Œç‰¹åˆ«æ˜¯åœ¨å®æ—¶æ¸²æŸ“åœºæ™¯ä¸­éå¸¸æœ‰æ•ˆã€‚

---

**BRDF å®Œæ•´æ¨¡å‹**ï¼šåœ¨å®Œæ•´çš„ BRDF æ¨¡å‹ï¼ˆå¦‚ Cook-Torrance æ¨¡å‹ï¼‰ä¸­ï¼Œé€šå¸¸ä¼šåŒæ—¶è€ƒè™‘ _è²æ¶…å°”é¡¹_ ã€_å‡ ä½•é®æŒ¡é¡¹_ å’Œ _å¾®è¡¨é¢åˆ†å¸ƒé¡¹_ ï¼Œè¿™ä¸‰éƒ¨åˆ†å…±åŒæè¿°å…‰çº¿åœ¨ç‰©ä½“è¡¨é¢ä¸Šçš„åå°„è¡Œä¸ºã€‚

- è²æ¶…å°”é¡¹ï¼šæè¿°åå°„ç‡å¦‚ä½•éšè§’åº¦å˜åŒ–ã€‚
- å‡ ä½•é®æŒ¡é¡¹ï¼ˆGï¼‰ï¼šæè¿°è¡¨é¢å¾®ç»“æ„å¦‚ä½•å½±å“å…‰çº¿è¢«é®æŒ¡æˆ–é˜»æŒ¡ã€‚
- å¾®è¡¨é¢åˆ†å¸ƒé¡¹ï¼ˆDï¼‰ï¼šæè¿°è¡¨é¢å¾®è§‚ç»“æ„çš„æ³•çº¿æ–¹å‘åˆ†å¸ƒï¼Œå½±å“é«˜å…‰çš„å½¢çŠ¶å’Œå¤§å°ã€‚

### æŠ˜å°„

#### æŠ˜å°„æ–¹å‘çš„è®¡ç®—

**~~æŠ˜å°„æ–¹å‘åˆ†æ~~**

**ç›®æ ‡**

åˆ°æŠ˜å°„æ–¹å‘ï¼Œç”¨æŠ˜å°„æ–¹å‘å»é‡‡æ · CubeMap

<img
	src='/assets/Effects/Ice/img16.png'
	alt='img16'
	style='width: 60%; height: auto; display:block; margin: 0 auto;'
/>

---

**æ¨å¯¼è¿‡ç¨‹**

<img
	src='/assets/Effects/Ice/img17.png'
	alt='img17'
	style='width: 60%; height: auto; display:block; margin: 0 auto;'
/>

$$ Ï‰ $$ æ˜¯ç©ºæ°”æŠ˜å°„ç‡ä¸æ°´ _æŠ˜å°„ç‡çš„æ¯”å€¼_

$$ cosÎ¸*i $$ å¯ä»¥å†™æˆ *å…¥å°„æ–¹å‘ `L` ä¸ æ³•çº¿ `N` çš„ç‚¹ä¹˜\_ ï¼ˆç”±äºLä¸Nçš„å¤¹è§’å¤§äº90åº¦ï¼Œå› æ­¤ç‚¹ä¹˜ç»“æœæ˜¯è´Ÿæ•°ï¼Œéœ€è¦å†ä¹˜ä»¥-1ï¼‰

<br></br>
**~~ä»£ç å®ç°~~**

```csharp
half4 EffectRefraction(IceInputData inputData)
{
    // n1/n2
    // ç©ºæ°”ä¸æ°´æŠ˜å°„ç‡çš„æ¯”å€¼0.75
    float w = 0.75;

    // coså…¥å°„è§’åº¦ï¼š-N dot L
    float cosi = dot(inputData.pixelNormalWS, inputData.viewDirectionWS);

    // cosæŠ˜å°„åçš„å‡ºå°„è§’åº¦
    float cost = 1.0 - w * w * (1.0 - cosi * cosi);
    cost = sqrt(cost);
    // è®¡ç®—å‡ºæŠ˜å°„æ–¹å‘
    float3 refractDir = w * (-inputData.viewDirectionWS) + inputData.pixelNormalWS * (w * cosi - cost);

    // ç”¨æŠ˜å°„å‡ºå°„æ–¹å‘é‡‡æ ·CubeMap
    half3 color = texCUBE(_ReflectionTexture, refractDir).rgb;

    // æ¨¡æ‹Ÿé¢œè‰²å¸æ”¶ï¼Œä¹˜ä»¥ä¸€ä¸ªæŠ˜å°„é¢œè‰²
    color *= _RefractionColor.rgb;

    return half4(color, 1.0);
}
```

---

HLSLå†…ç½®refractå‡½æ•°

```csharp
half4 EffectRefraction(IceInputData inputData)
{
    // n1/n2
    float w = 0.75;
    float3 L = -inputData.viewDirectionWS;
    float3 N = inputData.pixelNormalWS;

    // é‡‡æ ·CubeMap
    // refract() å‡½æ•°æ‰€éœ€å‚æ•°ï¼š
    // 1. ä¸–ç•Œåæ ‡ä¸‹çš„è§‚æµ‹æ–¹å‘
    // 2. pixelNormalçš„æ–¹å‘
    // 3. ä¸¤ç§ä»‹è´¨çš„æŠ˜å°„æ¯”
    half3 color = texCUBE(_ReflectionTexture, refract(L, N, w)).rgb;

    // æ¨¡æ‹Ÿé¢œè‰²å¸æ”¶ï¼Œä¹˜ä»¥ä¸€ä¸ªæŠ˜å°„é¢œè‰²
    color *= _RefractionColor.rgb;

    return half4(color, 1.0);
}
```

<br></br>
**~~æ¨¡æ‹Ÿå…‰çš„è‰²æ•£ç°è±¡~~**

åœ¨ç°å®ä¸­ï¼Œå…‰åœ¨ä¸åŒä»‹è´¨çš„æŠ˜å°„ç‡ä¼šæ ¹æ®æ³¢é•¿ä¸åŒè€Œæœ‰æ‰€åŒºåˆ«ã€‚å³ä¸åŒé¢œè‰²çš„å…‰åœ¨ä¸åŒä»‹è´¨ä¸­çš„æŠ˜å°„ç‡ä¸ä¸€æ ·ã€‚

<img
	src='/assets/Effects/Ice/img18.png'
	alt='img18'
	style='width: 60%; height: auto; display:block; margin: 0 auto;'
/>

- å¦‚å½“ä¸€æŸç™½å…‰å°„å…¥æ°´ä¸­æ—¶ï¼Œå…¶ä¸­:
  - çº¢å…‰åœ¨æ°´ä¸­çš„æŠ˜å°„ç‡ $$ nr = 1.3311 $$
  - ç»¿å…‰åœ¨æ°´ä¸­çš„æŠ˜å°„ç‡ $$ ng = 1.3371$$
  - è“å…‰åœ¨æ°´ä¸­çš„æŠ˜å°„ç‡ $$nb = 1.3428$$
- è¿™äº›ä¸ä¸€æ ·çš„æŠ˜å°„ç‡å°±ä¼šäº§ç”Ÿå…‰çš„è‰²æ•£ç°è±¡
- æ³¢é•¿è¶Šå¤§ï¼ŒæŠ˜å°„ç‡è¶Šå°ï¼ˆçº¢å…‰æ³¢é•¿å¤§ï¼ŒæŠ˜å°„ç‡å°ï¼Œæ‰€ä»¥åç§»è§’åº¦å°ï¼‰

---

**ä»£ç å®ç°**

ä¹‹å‰æ‰€è®¡ç®—çš„ `n1 / n2` ä¸­çš„ `n2` æ˜¯ _å¯è§å…‰æ¯”è¾ƒé ä¸­é—´çš„æ³¢é•¿ 589nm çš„æŠ˜å°„ç‡ã€‚_

å¦‚ä»Šè¦è€ƒè™‘åˆ°è‰²æ•£ç°è±¡ï¼Œå°±æŠŠ n2 æ›¿æ¢æˆ RGB ä¸‰ç§å…‰å¯¹åº”æ³¢é•¿çš„æŠ˜å°„ç‡ wr wg wb

```csharp
half4 EffectRefraction(IceInputData inputData)
{
    // n1/nr
    float wr = 0.7513;
    // n1/ng
    float wg = 0.7479;
    // n1/nb
    float wb = 0.7447;

    float3 L = -inputData.viewDirectionWS;
    float3 N = inputData.pixelNormalWS;

    // åªè€ƒè™‘ RGB ä¸‰ç§å…‰æºçš„è‰²æ•£æ•ˆæœ
    half3 refractR = texCUBE(_ReflectionTexture, refract(L, N, wr)).rgb;
    half3 refractG = texCUBE(_ReflectionTexture, refract(L, N, wg)).rgb;
    half3 refractB = texCUBE(_ReflectionTexture, refract(L, N, wb)).rgb;
    half3 color = half3(refractR.r, refractG.g, refractB.b);

    // æ¨¡æ‹Ÿé¢œè‰²å¸æ”¶ï¼Œä¹˜ä»¥ä¸€ä¸ªæŠ˜å°„é¢œè‰²
    color *= _RefractionColor.rgb;

    return half4(color, 1.0);
}
```

<br></br>
#### é€å°„å‡½æ•° BTDF çš„è®¡ç®—

**~~è²æ¶…å°”é¡¹è®¡ç®—é€å°„~~**

**é€å°„å‡½æ•° BTDF çš„è®¡ç®—**

- å‰é¢æ‰€è®¡ç®—çš„è²å°¼å°”å…¬å¼çš„ç»“æœå°±æ˜¯ _å…‰çº¿çš„åå°„_ æ‰€å æ€»å…‰èƒ½çš„æ¯”ä¾‹ï¼Œå‡è®¾å…‰çº¿åªæœ‰æŠ˜å°„å’Œåå°„ï¼Œæ²¡æœ‰å…¶ä»–çš„æŸå¤±ï¼ˆå³ï¼‰ï¼Œé‚£ä¹ˆ BTDF çš„ç»“æœå°±æ˜¯ 1 - è²æ¶…å°”é¡¹
- **åå°„ç‡ R** ï¼šè²æ¶…å°”å…¬å¼è®¡ç®—çš„æ˜¯åå°„ç‡ï¼Œå³å…¥å°„å…‰ä¸­æœ‰å¤šå°‘æ¯”ä¾‹çš„å…‰èƒ½è¢«åå°„å›åŸæ¥çš„ä»‹è´¨ã€‚è¿™ä¸ªåå°„ç‡ä¸å…¥å°„è§’ã€ä»‹è´¨çš„æŠ˜å°„ç‡ç›¸å…³ã€‚
- **æŠ˜å°„ç‡ T** ï¼šé€å°„ï¼ˆæˆ–æŠ˜å°„ï¼‰å…‰çš„æ¯”ä¾‹å¯ä»¥é€šè¿‡ _1 - åå°„ç‡_ æ¥å¾—åˆ°ã€‚ç”±äºèƒ½é‡å®ˆæ’ï¼Œé€å°„å…‰å’Œåå°„å…‰çš„èƒ½é‡æ€»å’Œåº”è¯¥ç­‰äºå…¥å°„å…‰çš„æ€»èƒ½é‡ã€‚å¦‚æœå¿½ç•¥å…‰å¸æ”¶ç­‰å…¶ä»–æŸè€—ï¼Œé€å°„ç‡ T ç­‰äº 1 âˆ’ R
- åå°„ç‡ + é€å°„ç‡ = 1
- $$ R+T=1 $$

---

**BRDF å’Œ BTDF çš„åŒºåˆ«**

BRDFï¼ˆåŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼‰ï¼šæè¿°å…‰çº¿ä»ä¸€ä¸ªæ–¹å‘å…¥å°„ï¼Œå¹¶ä»å¦ä¸€ä¸ªæ–¹å‘åå°„çš„åˆ†å¸ƒï¼Œä¸»è¦é’ˆå¯¹åå°„è¡Œä¸ºã€‚

BTDFï¼ˆåŒå‘é€å°„åˆ†å¸ƒå‡½æ•°ï¼‰ï¼šæè¿°å…‰çº¿ä»ä¸€ä¸ªæ–¹å‘å…¥å°„ï¼Œ _å¹¶ä»ç‰©ä½“è¡¨é¢å¦ä¸€ä¾§é€å°„å‡ºæ¥çš„åˆ†å¸ƒ_ï¼Œä¸»è¦é’ˆå¯¹é€å°„è¡Œä¸º

---

**ä»£ç å®ç°**

```csharp
half4 UnlitPassFragment(Varyings input) : SV_Target
{
    //åˆå§‹åŒ– inputData
    IceInputData inputData;
    InitializeIceData(input, inputData);
    half4 finalColor = 1;

    // è®¡ç®—åå°„
    half4 reflection = EffectReflection(inputData);

    // è®¡ç®—æŠ˜å°„
    // reflection.a é€šé“å‚¨å­˜ç€åå°„å‡½æ•°ä¸­è®¡ç®—çš„fresnelé¡¹
    finalColor.rgb = EffectRefraction(inputData).rgb * (1 - reflection.a);

    return finalColor;
}
```

### æ•£å°„

#### åˆ†æ

<img
	src='/assets/Effects/Ice/img19.png'
	alt='img19'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

**~~å†°çš„è£‚ç¼~~**

<img
	src='/assets/Effects/Ice/img20.jpg'
	alt='img20'
	style='width: 30%; height: auto; display:block; margin: 0 auto;'
/>

å†°é¢è£‚ç¼ç‰¹å¾

- æ²¿è£‚ç¼ï¼Œ_æ¥è¿‘å†°å—è¡¨é¢_ æ—¶ _é¢œè‰²æœ€æ·±_ï¼ˆæ¥è¿‘çº¯ç™½è‰²ï¼‰
- æ²¿ç€è¡¨é¢æ³•çº¿æ–¹å‘å¾€é‡Œç”Ÿé•¿ï¼Œé¢œè‰²é€æ¸å˜æµ…æ…¢æ…¢æ¶ˆå¤±
- è¿™ç§ç°è±¡å·²ç»è„±ç¦»äº†ç‰©ä½“è¡¨é¢ï¼Œä½†æ˜¯æˆ‘ä»¬Shaderçš„è®¡ç®—éƒ½æ˜¯åœ¨è¡¨é¢è¿›è¡Œï¼Œè¿™å°±éœ€è¦ç”¨ä¸€ç§æ‰‹æ®µæ¥æ¨¡æ‹Ÿæ•ˆæœ

<br></br>
**~~å†°çš„æ‚è´¨~~**

<img
	src='/assets/Effects/Ice/img21.jpg'
	alt='img21'
	style='width: 30%; height: auto; display:block; margin: 0 auto;'
/>

å†°å†…éƒ¨æ‚è´¨ç‰¹å¾

- å‡å¦‚å†°å—å®Œå…¨ç”±æ°´åˆ†å­ç»„æˆï¼Œé‚£ä¹ˆé€šå¸¸æƒ…å†µä¸‹æ˜¯é€æ˜çš„ã€‚ä½†å®é™…ä¸Šå³ä½¿æ˜¯è¶…çº¯æ°´ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸é€æ˜çš„å†°å—ï¼Œ_è¿™æ˜¯å› ä¸ºæ°´ä¸­æº¶è§£çš„æ°”ä½“ï¼Œç”±äºæ¸©åº¦é™ä½ï¼ŒæŒ¤å‹å‡ºæ¥çš„æ°”ä½“æ— æ³•é€ƒé€¸ï¼Œå°±ä¼šåœ¨å†°å—å†…éƒ¨å½¢æˆç©ºè…”ã€‚_
- å‡è®¾ç¯å¢ƒå…‰ç…§å‡åŒ€ï¼Œæ‚è´¨åœ¨å†°å—ä¸­ä¹Ÿæ˜¯å‡åŒ€åˆ†å¸ƒï¼Œé‚£ä¹ˆæ‚è´¨é¢œè‰²ä¹˜ä»¥è§†è§‰å½’ä¸€åŒ–çš„ç‰©ä½“åšåº¦å³å¯ã€‚

#### è£‚ç¼

**~~SDF æœ‰å‘è·ç¦»åœº~~**

> ğŸ“£ **æœ‰å‘è·ç¦»åœº Signed Distance Field (SDF)**
>
> SDFæ˜¯ä¸€ä¸ªåœºï¼Œåœºå†…çš„æ¯ä¸€ä¸ªç‚¹ï¼Œ_è¡¨è¾¾äº†è·ç¦»æœ€è¿‘ç‰©ä½“çš„è·ç¦»_
>
> ç”±äºåˆ†ç‰©ä½“å†…å’Œç‰©ä½“å¤–ï¼Œå› æ­¤è·ç¦»å€¼åŒºåˆ†æ­£è´Ÿï¼Œå› æ­¤å‘½åä¸ºæœ‰å‘è·ç¦»åœºã€‚

---

**2D SDF**

<img
	src='/assets/Effects/Ice/img22.png'
	alt='img22'
	style='width: 80%; height: auto; display:block; margin: 0 auto;'
/>

2Då¹³é¢å†…çš„æ¯ä¸€ä¸ªç‚¹è®°å½•ä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œåˆšå¥½æ¥è§¦åˆ°ç‰©ä½“çš„åœ°æ–¹æ˜¯0ï¼Œç‰©ä½“å¤–éƒ¨æ˜¯è®°å½•æ­£æ•°çš„è·ç¦»é‡ï¼Œç‰©ä½“å†…éƒ¨æ˜¯è®°å½•è´Ÿæ•°çš„è·ç¦»é‡

SDFå›¾é€šå¸¸åªè®°å½•[-1,1]åŒºé—´çš„è·ç¦»ï¼Œå½’ä¸€åŒ–ä¹‹åæ˜¯[0,1]çš„åŒºé—´å–å€¼ï¼Œ- _0.5çš„æ•°å€¼å°±æ˜¯åˆšå¥½æ¥è§¦ç‰©ä½“çš„åœ°æ–¹_ - [0.5,1]æ˜¯ç‰©ä½“å†…éƒ¨ - [0,0.5]æ˜¯ç‰©ä½“å¤–éƒ¨ã€‚

<br></br>
**~~SDF Raymarching ç®—æ³•~~**

**åŸºæœ¬æ¦‚å¿µ**

- **SDFï¼ˆæœ‰ç¬¦å·è·ç¦»å‡½æ•°ï¼‰** ï¼š SDF æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ_è¾“å…¥ç‚¹ $$ p(x,y,z)$$ è¡¨ç¤ºç©ºé—´ä¸­çš„æŸä¸ªä½ç½®ï¼Œè¾“å‡ºä¸€ä¸ªæ•°å€¼ï¼Œè¡¨ç¤ºè¯¥ç‚¹åˆ°æœ€è¿‘ç‰©ä½“è¡¨é¢çš„æœ€å°è·ç¦»ã€‚_
  - è¿™ä¸ªå€¼æ˜¯æœ‰ç¬¦å·çš„ï¼Œé€šå¸¸çº¦å®š _æ­£æ•°è¡¨ç¤ºç‚¹åœ¨ç‰©ä½“å¤–éƒ¨ï¼Œè´Ÿæ•°è¡¨ç¤ºç‚¹åœ¨ç‰©ä½“å†…éƒ¨ï¼Œè€Œé›¶è¡¨ç¤ºç‚¹åœ¨ç‰©ä½“è¡¨é¢ä¸Šã€‚_
- **Raymarchingï¼ˆå…‰çº¿è¡Œè¿›ï¼‰**ï¼š ç±»ä¼¼äºå…‰çº¿æŠ•å°„ï¼ˆraycastingï¼‰ï¼Œä½† raymarching å¹¶éä¸€æ­¥å‘½ä¸­ï¼Œè€Œæ˜¯æ²¿ç€å…‰çº¿ä»¥ä¸€å®šæ­¥é•¿è¿›è¡Œå‰è¿›ã€‚å…‰çº¿æ¯æ¬¡å‰è¿›çš„æ­¥é•¿ç”± SDF å‡½æ•°çš„å€¼æ¥æ§åˆ¶ï¼Œè¿™æ ·å…‰çº¿æ¯æ¬¡éƒ½èƒ½å¤Ÿè·³è¿‡ç©ºæ—·åŒºåŸŸï¼ŒåŠ å¿«æ”¶æ•›é€Ÿåº¦ã€‚

---

**ç®—æ³•æ­¥éª¤**

- **åˆå§‹åŒ–å…‰çº¿ï¼š** ä»ç›¸æœºæˆ–è§‚å¯Ÿè€…çš„èµ·ç‚¹ï¼Œå‘æŸä¸ªæ–¹å‘å‘å°„ä¸€æ¡å…‰çº¿ã€‚
- **è¡Œè¿›è¿‡ç¨‹ï¼š**
  - åœ¨æ¯ä¸ªä½ç½® `p(x,y,z)` ï¼Œé€šè¿‡ SDF è®¡ç®—ç‚¹åˆ°ç‰©ä½“è¡¨é¢çš„è·ç¦» `d` ã€‚
  - _å¦‚æœè·ç¦» `d` è¶³å¤Ÿå°ï¼ˆå³å°äºæŸä¸ªé˜ˆå€¼ï¼‰ï¼Œåˆ™è®¤ä¸ºå…‰çº¿ä¸ç‰©ä½“ç›¸äº¤ï¼Œå‘½ä¸­ç‚¹ç¡®å®šã€‚_
  - å¦‚æœè·ç¦»å¾ˆå¤§ï¼Œå…‰çº¿å°±ä»¥è¯¥è·ç¦»ä½œä¸ºæ­¥é•¿å‘å‰è¡Œè¿›ã€‚
  - è¿™ä¸ªè¿‡ç¨‹é‡å¤è¿›è¡Œï¼Œç›´åˆ°æ‰¾åˆ°ç›¸äº¤ç‚¹æˆ–è€…å…‰çº¿ç¦»å¼€è§†é‡èŒƒå›´ï¼ˆæˆ–è¶…å‡ºæœ€å¤§æ­¥æ•°é™åˆ¶ï¼Œåˆ¤æ–­ä¸ºæœªå‘½ä¸­ï¼‰ã€‚
- **æ¸²æŸ“ï¼š** ä¸€æ—¦å…‰çº¿å‘½ä¸­ç‰©ä½“è¡¨é¢ï¼Œç»§ç»­æ‰§è¡Œé˜´å½±ã€å…‰ç…§ã€åå°„ç­‰è®¡ç®—ï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„åƒç´ é¢œè‰²ã€‚

---

**SDF Raymarching è§£é‡Š**

<img
	src='/assets/Effects/Ice/img23.png'
	alt='img23'
	style='width: 90%; height: auto; display:block; margin: 0 auto;'
/>

- ä»æ‘„åƒæœºå‡ºå‘å‘åœºæ™¯å†…å‘å°„ä¸€æ¡å°„çº¿ï¼Œå°„çº¿é‡‡ç”¨æ­¥è¿›æ–¹å¼
- SDF è®°å½•äº†åœºæ™¯ä¸­æ¯ä¸€ä¸ªç‚¹åˆ°æ‰€æœ‰ç‰©ä½“çš„æœ€è¿‘è·ç¦»
- ä»¥å½“å‰ç‚¹ä¸ºåœ†å¿ƒï¼Œ_å½“å‰ç‚¹åˆ°åœºæ™¯ä¸­æœ€è¿‘ç‰©ä½“è¡¨é¢çš„è·ç¦»ä¸ºåŠå¾„ã€‚_ æ¯æ¬¡å°„çº¿çš„æ­¥è¿›è·ç¦»ä¸ºè¯¥åŠå¾„è·ç¦»ï¼Œå³å‡½æ•° y = SDFï¼ˆpï¼‰çš„å€¼
- å¦‚ y > 0, åˆ™è¡¨ç¤ºæ­¥è¿›åç‚¹ p ä»åœ¨ç‰©ä½“è¡¨é¢å¤–ï¼Œå¹¶æœªå‡»ä¸­ç‰©ä½“ï¼Œå¯ä»¥å®‰å…¨æ­¥è¿›
- _å¦‚æœå½“ç‚¹ p åˆ°ç‰©ä½“çš„è·ç¦»ä¸º y < 0, åˆ™è¡¨ç¤ºç‚¹ p åœ¨ç‰©ä½“å†…éƒ¨ï¼Œä»£è¡¨å°„çº¿å‡»ä¸­ç‰©ä½“è¡¨é¢ï¼Œå…‰çº¿åœæ­¢æ­¥è¿›_

---

**ä¼ªä»£ç **

```csharp
float Raymarching(float3 rayOri, float3 rayDir, float maxDepth, int maxIteration)
{
    // æ²¿ç€å°„çº¿æ–¹å‘ç§»åŠ¨çš„è·ç¦»
    // t: ç§»åŠ¨è·ç¦»
    float t = 0;

    // åœ¨æœ‰æ•ˆæ­¥è¿›æ•°å†…å±•å¼€å¾ªç¯
    for(int i = 0; i < maxIteration; i++)
    {
        // å½“è¶…è¿‡æœ€å¤§æ­¥è¿›è·ç¦»åˆ™é€€å‡º
        if (t > maxDepth) break;

        // è®¡ç®—å½“å‰ p ç‚¹çš„ä½ç½®ï¼šåŸç‚¹ + å°„çº¿æ–¹å‘ * ç§»åŠ¨è·ç¦»
        float3 p = rayOri + rayDir * t;

        // è·å–å½“å‰ p ç‚¹çš„ SDF å€¼
        float d = SDF(p);

        // å½“ SDF å€¼å°‘äºç­‰äº0è¯´æ˜å°„çº¿å·²ç»å‡»ä¸­ç‰©ä½“ï¼Œé€€å‡ºå¾ªç¯
        if (d <= 0) break;

        // æ›´æ–°ç§»åŠ¨è·ç¦»
        t += d;
    }
    // è¿”å›ç§»åŠ¨è·ç¦»
    return t;
}
```

<br></br>
**~~è£‚ç¼çš„å…·ä½“å®ç°æ–¹æ³•~~**

**è·å¾—è®°å½•ç‰©ä½“è¡¨é¢è£‚ç¼çš„ SDF å›¾**

<img
	src='/assets/Effects/Ice/img24.png'
	alt='img24'
	style='width: 90%; height: auto; display:block; margin: 0 auto;'
/>

- æ‰€æœ‰è®¡ç®—æ˜¯åœ¨åˆ‡çº¿ç©ºé—´ä¸‹å®Œæˆï¼Œæ‰€ä»¥éœ€è¦è·å– _åˆ‡çº¿ç©ºé—´ä¸‹çš„ $$V$$ æ–¹å‘_
- $$Vxy$$ æ˜¯ $$V$$ æ–¹å‘åœ¨ç‰©ä½“è¡¨é¢çš„æŠ•å½±
- $$-kVxy$$ æ˜¯ $$Vxy$$ çš„ç›¸åæ–¹å‘
- $$-kV$$ æ˜¯ $$V$$ çš„åå‘å»¶é•¿æ–¹å‘ï¼Œå‡è®¾ $$-kV$$ èƒ½ä¸è£‚ç¼ç›¸äº¤ï¼Œé‚£ä¹ˆ $$-kVxy$$ å°±æ˜¯åœ¨ç‰©ä½“è¡¨é¢Pç‚¹åˆ°è£‚ç¼ä½ç½®çš„æœ€çŸ­è·ç¦»ï¼Œç°åœ¨æˆ‘ä»¬è¦è®¡ç®—è¿™ä¸ªè·ç¦»å€¼

---

**ä»£ç å®ç°**

- å¯¹äºç‰©ä½“è¡¨é¢çš„æ¯ä¸€ä¸ªåƒç´ ç‚¹ $$p$$ ï¼Œè®¡ç®—å…¶è·ç¦»æœ€è¿‘è£‚ç¼çš„æœ€è¿‘è·ç¦»
- ä»ç‚¹ $$p$$ å‡ºå‘ï¼Œå°„çº¿æ–¹å‘ä¸ºè§‚æµ‹æ–¹å‘ $$V$$
- å½“æ­¥è¿›åˆ°æŸä¸ªç‚¹ $$pâ€™$$ ,ä½¿å¾— SDF é‡‡æ ·å€¼å°äº 0 æ—¶ï¼Œå³è¯¥ç‚¹ $$p'$$ å¤„äºè£‚ç¼å†…éƒ¨

```csharp
half SDF_Raymarching(sampler2D tex, float2 baseUV, float2 offsetUV, int numSteps, half stepSize, half edgeWidth)
{
    // èµ·å§‹ç‚¹
    float2 p = baseUV;
    // å½’ä¸€åŒ–åè·å¾—æ–¹å‘
    float2 dir = normalize(offsetUV);
    // èµ·å§‹ç‚¹åˆ°ç»ˆç‚¹çš„è·ç¦»
    float value = 0.0;

    for (int i = 0; i < numSteps && i < 10; i++)
    {
        // é€šè¿‡é‡‡æ · SDF å›¾æ±‚å¾—å½“å‰ p ç‚¹ä¸æœ€è¿‘è£‚ç¼è·ç¦»
        // å¾ªç¯å†…åªèƒ½å¯¹çº¹ç†çš„å•ä¸€ MipMap ç­‰çº§é‡‡æ ·
        float distance = 1 - tex2Dlod(tex, float4(p, 0,0)).r;
        // åŠ å…¥ edgeWidth å¾®è°ƒå®½åº¦æ•ˆæœ
        distance -= edgeWidth;

        // å½“è·ç¦»å°‘äº0ï¼Œè¯´æ˜å·²ç»å‡»ä¸­ç‰©ä½“ï¼Œé€€å‡ºå¾ªç¯
        if (distance < 0.0)
            break;

        // ä¸ä¸º0çš„æ—¶å€™ï¼Œè®°å½•å½“å‰ t ï¼Œæ›´æ–° p ç‚¹ä½ç½®
        float t = distance * stepSize;
        p += dir * t;
        value += t;
    }

    return value;
}
```

ç›¸æ¯”äºä¹‹å‰çš„ä¼ªä»£ç ï¼Œè¿™æ®µè®¡ç®—å…¨éƒ¨åœ¨ç‰©ä½“è¡¨é¢å®Œæˆï¼Œæ˜¯å±äºåœ¨ _åˆ‡çº¿ç©ºé—´_ çš„äºŒç»´è®¡ç®—

SDFå€¼é€šè¿‡ç‰©ä½“è¡¨é¢çš„ä½ç½®ï¼ˆUVåæ ‡ï¼‰ _é‡‡æ ·SDFå›¾_ è·å¾—ã€‚

---

ä½¿ç”¨ stepSize çš„åŸå›  - _é¿å…è¿‡å¿«çš„å…‰çº¿å‰è¿›:_ ç›´æ¥ä½¿ç”¨ `distance` ä½œä¸ºæ­¥è¿›è·ç¦»å¯èƒ½ä¼šå¯¼è‡´å…‰çº¿åœ¨æŸäº›æƒ…å†µä¸‹å‰è¿›å¾—å¤ªå¿«ï¼Œå°¤å…¶æ˜¯åœ¨è·ç¦»å€¼å¾ˆå¤§çš„æƒ…å†µä¸‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…‰çº¿å¯èƒ½ä¼šè·³è¿‡ç‰©ä½“ï¼Œå¯¼è‡´æ¼æ‰ç»†èŠ‚æˆ–æ— æ³•æ­£ç¡®æ£€æµ‹åˆ°ç‰©ä½“çš„è¡¨é¢ã€‚- _ç¨³å®šæ€§:_ ä¹˜ä»¥ `stepSize` å¯ä»¥æ§åˆ¶æ¯ä¸€æ­¥çš„ç§»åŠ¨é‡ï¼Œä½¿å…‰çº¿è¡Œè¿›æ›´åŠ ç¨³å®šã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ `distance` å¯èƒ½ä¼šæœ‰å™ªå£°æˆ–ä¸è§„åˆ™æ³¢åŠ¨ï¼Œç›´æ¥ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´å…‰çº¿è¡Œè¿›çš„ä¸ç¨³å®šã€‚é€šè¿‡å¼•å…¥ä¸€ä¸ªå›ºå®šçš„æ­¥é•¿ï¼Œå¯ä»¥ä½¿å…‰çº¿è¡Œè¿›è¿‡ç¨‹æ›´åŠ å¯æ§ã€‚- _ç²¾åº¦è°ƒèŠ‚:_ `stepSize` æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥è°ƒèŠ‚å…‰çº¿è¡Œè¿›çš„ç²¾åº¦å’Œæ€§èƒ½ã€‚é€šè¿‡è°ƒæ•´ `stepSize` ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°åœ¨æ¸²æŸ“é€Ÿåº¦å’Œç»†èŠ‚ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦æ›´ç²¾ç»†çš„æ¸²æŸ“æ•ˆæœï¼Œå¯ä»¥å‡å° `stepSize` ï¼Œä½¿å¾—å…‰çº¿åœ¨æ¯æ¬¡è¿­ä»£ä¸­ç§»åŠ¨æ›´å°‘ï¼Œä»è€Œé‡‡æ ·å¾—æ›´ç²¾ç¡®ã€‚- _é¿å…é™·å…¥æ— ç©·å¾ªç¯:_ å¦‚æœ `distance` çš„å€¼è¿‡å¤§ï¼Œå…‰çº¿å¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µä¸‹æ— é™åˆ¶åœ°å‘å‰ç§»åŠ¨ï¼Œå¯¼è‡´è¿­ä»£æ¬¡æ•°è¿‡å¤šï¼Œç”šè‡³è¿›å…¥æ— ç©·å¾ªç¯ã€‚ä½¿ç”¨ `stepSize` å¯ä»¥å¸®åŠ©é™åˆ¶æ¯ä¸€æ­¥çš„ç§»åŠ¨é‡ï¼Œä»è€Œæ§åˆ¶æ€»çš„è¿­ä»£æ¬¡æ•°ã€‚- _æé«˜å¯è°ƒæ€§:_ `stepSize` å¯ä»¥æ–¹ä¾¿åœ°ä½œä¸ºä¸€ä¸ªå‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œä½¿å¾—å…‰çº¿è¡Œè¿›çš„è¡Œä¸ºæ›´åŠ çµæ´»ã€‚åœ¨ä¸åŒåœºæ™¯ä¸‹ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„æ­¥é•¿æ¥è¾¾åˆ°æœ€ä½³çš„æ¸²æŸ“æ•ˆæœã€‚

---

**ä»£ç å®ç°**

```csharp
half EffectCracks(Varyings input, IceInputData inputData)
{
    // baseUV åœ¨åˆ‡çº¿æ–¹å‘ä¸Šå¯¹åŸå§‹UVåšä¸€äº›æ³•çº¿çš„æ‰°åŠ¨ï¼Œè®©è£‚ç¼çœ‹èµ·æ¥æ›´åŠ è‡ªç„¶
    float2 baseUV = input.uv + inputData.normalTS.xy * _CracksDistortion;

    // -Vxy Våœ¨ç‰©ä½“è¡¨é¢çš„æŠ•å½±æ–¹å‘çš„åæ–¹å‘ï¼Œä¹˜ä»¥_CracksHeightåšé«˜åº¦å¾®è°ƒ
    // inputData.viewDirectionTS.xy è¡¨ç¤ºåˆ‡çº¿ç©ºé—´ä¸‹ï¼Œè§†è§’æ–¹å‘åœ¨ç‰©ä½“è¡¨é¢çš„æŠ•å½±
    float2 offsetUV = -inputData.viewDirectionTS.xy * _CracksHeight;
    int numSteps = _CracksDepthIterations; //æ­¥è¿›æ¬¡æ•°é™åˆ¶
    half stepSize = _CracksDepthStepSize; //æ¯æ¬¡æ­¥è¿›çš„é•¿åº¦
    half edgeWidth = _CracksWidth;// è£‚ç¼è¾¹ç¼˜å®½åº¦

    // SDF Raymarching è®¡ç®—
    half depthCracks = SDF_Raymarching(_CracksSDFTexture, baseUV, offsetUV, numSteps, stepSize, edgeWidth);

    // è§†è§’æ–¹å‘æŠ•å½±é•¿åº¦ä¸è£‚ç¼è·ç¦»çš„å·®
    // viewDirectionTS åœ¨ç‰©ä½“è¡¨é¢çš„æŠ•å½±é•¿åº¦ å‡å» SDF_Raymarching çš„è·ç¦»
    depthCracks = length(offsetUV) - depthCracks;

    // è£‚ç¼æ·±åº¦å’Œç¼©æ”¾é™åˆ¶
    depthCracks *= _CracksDepthScale;
    depthCracks = saturate(depthCracks);

    return depthCracks;
}
```

`CracksHeight` ä¸»è¦æ§åˆ¶çš„æ˜¯è§†è§’æ–¹å‘åœ¨è¡¨é¢ä¸Šçš„æŠ•å½±æ·±åº¦ï¼Œç›´æ¥å½±å“è£‚ç¼åœ¨è¡¨é¢ä¸Šçš„è§†è§‰é«˜åº¦ï¼Œå½±å“è£‚ç¼åœ¨è¡¨é¢çš„å½¢æ€å’Œå¤§å°ã€‚

`CracksDepthScale` ä¸»è¦æ˜¯ä¸€ä¸ªå…¨å±€ç¼©æ”¾å› å­ï¼Œç”¨äºè°ƒèŠ‚è£‚ç¼æ·±åº¦æ•ˆæœçš„å¼ºåº¦ï¼Œå½±å“çš„æ˜¯è£‚ç¼æ·±åº¦çš„è§†è§‰å¼ºåº¦ã€‚

#### æ‚è´¨

**~~åŸºæœ¬è‰²~~**

æ¨¡æ‹Ÿä½“ç§¯æ„Ÿï¼Œå°†ç‰©ä½“åˆ†ä¸ºè¡¨é¢å±‚å’Œæ¬¡è¡¨é¢å±‚ï¼Œåªè¦æ§åˆ¶ä¸åŒçš„è§†è§‰åç§»å»å¤šæ¬¡é‡‡æ ·ï¼Œå°±èƒ½æ¨¡æ‹Ÿå¤šå±‚æ¬¡è¡¨é¢å±‚ï¼Œæ¨¡æ‹Ÿå‡ºä½“ç§¯æ„Ÿ

- è¡¨é¢å±‚ï¼šç›´æ¥ _çº¹ç†åæ ‡é‡‡æ ·_
- æ¬¡è¡¨é¢å±‚ï¼šé€šè¿‡ _çº¹ç†åæ ‡_ åŠ  _è§†è§‰åç§»å€¼_ æ¨¡æ‹Ÿå‡ºçºµæ·±æ„Ÿ

---

<img
	src='/assets/Effects/Ice/img25.png'
	alt='img25'
	style='width: 50%; height: auto; display:block; margin: 0 auto;'
/>

ç¤ºæ„å›¾åˆ†æ

- `Vxy` æ˜¯ `V` æ–¹å‘åœ¨ç‰©ä½“è¡¨é¢çš„æŠ•å½±ï¼Œçœ‹å›¾å¾—çŸ¥æˆ‘ä»¬éœ€è¦åæ–¹å‘ `-Vxy` åç§»ï¼Œ
- `k` æ˜¯åç§»ç³»æ•°ï¼Œå–å€¼èŒƒå›´ `k > 0`
- _`k = 0` çš„æ—¶å€™æ²¡æœ‰åç§»ï¼Œå°±æ˜¯è¡¨é¢å±‚çš„æ•ˆæœ_
- å½“ `k` å–å€¼è¶Šå¤§çš„æ—¶å€™ï¼Œæ¬¡è¡¨å±‚çš„æ·±åº¦å°±è¶Šæ·±

---

è§†è§‰åç§»çš„æ¨¡æ‹Ÿ

- ä½“ç§¯æ„Ÿçš„å…³é”®æ˜¯é€šè¿‡æ§åˆ¶è§†è§‰åç§»æ¥è®©è§‚å¯Ÿè€…æ„ŸçŸ¥åˆ°ç‰©ä½“ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå¹³é¢ï¼Œè€Œæ˜¯å…·æœ‰æ·±åº¦
- kæ§åˆ¶äº†åç§»çš„ç¨‹åº¦ï¼Œkè¶Šå¤§ï¼Œæ„å‘³ç€æ¬¡è¡¨é¢å±‚çœ‹èµ·æ¥è¶Šæ·±ï¼Œåç§»è¶Šæ˜æ˜¾ï¼›å½“ k=0æ—¶ï¼Œæ²¡æœ‰åç§»ï¼Œ _è¡¨é¢å±‚ä¸æ¬¡è¡¨é¢å±‚é‡åˆï¼Œç‰©ä½“çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªç®€å•çš„è¡¨é¢ã€‚_
- åç§»æ–¹å‘ä¸º âˆ’kVxyæ˜¯ä¸ºäº† _ç¡®ä¿æ¬¡è¡¨é¢å±‚å‘è§‚å¯Ÿè€…çš„åæ–¹å‘åç§»_ ï¼Œä½¿å¾—åœ¨è§†è§‰ä¸Šè¡¨ç°ä¸ºæœ‰æ·±åº¦çš„å†…éƒ¨ç»“æ„ã€‚è¿™ç§åå‘åç§»èƒ½å¤Ÿè®©æ¯ä¸€å±‚æ¬¡çš„è¡¨é¢æ˜¾å¾—æ›´è¿œï¼Œä»è€Œæ„æˆä¸€ä¸ªé€æ¸æ·±å…¥çš„æ•ˆæœï¼Œè¾¾åˆ°ä½“ç§¯æ„Ÿçš„æ¨¡æ‹Ÿã€‚

---

ä»£ç å®ç°

```csharp
half3 EffectDust(Varyings input, IceInputData inputData)
{
    // åŸºæœ¬UVåŠ å…¥æ—¶é—´å‚æ•°æ¨¡æ‹ŸæµåŠ¨æ•ˆæœ
    // _DustTextureUVAnim.xy: æ§åˆ¶UVåæ ‡åœ¨æ—¶é—´ä¸Šçš„åŠ¨ç”»é€Ÿåº¦ï¼Œæ§åˆ¶æ‚è´¨çš„æµåŠ¨é€Ÿåº¦
    float2 dustUV = input.uv + inputData.time * _DustTextureUVAnim.xy;

    // è§†è§‰åç§»å¢åŠ  _DustDepthShift å‚æ•°ä½œä¸º k ç³»æ•°
    // viewDirectionTS.xy : è§†è§‰æ–¹å‘Våœ¨ç‰©ä½“è¡¨é¢çš„æŠ•å½±Vxy
    // viewUVç›¸å½“äº -kVxy : æ¨¡æ‹Ÿäº†æ¬¡è¡¨å±‚ç›¸å¯¹äºè§†è§’çš„è§†è§‰ä½ç§»ã€‚
    float2 viewUV = -inputData.viewDirectionTS.xy * _DustDepthShift;

    // Layer1 æ¬¡è¡¨å±‚
    // _DustLayerBetween ä½œä¸ºä¸¤ä¸ª Layer ä¹‹é—´çš„åå·®å‚æ•°æ§åˆ¶
    // viewUVåªæ˜¯ä¸€ä¸ªå‘é‡ï¼ŒdustUV + viewUVè¡¨ç¤ºæ¬¡è¡¨é¢å±‚é‡‡æ ·ç‚¹
    float2 uv1 = dustUV + viewUV * _DustLayerBetween;
    float3 color1 = tex2D(_DustTexture, uv1).rgb;

    // Layer2 è¡¨å±‚
    float2 uv2 = dustUV + viewUV;
    float3 color2 = tex2D(_DustTexture, uv2).rgb;

    // FinalColor
    // å¢å¼ºé¢œè‰²çš„æ˜äº®åº¦å’Œé¥±å’Œåº¦
    float3 finalColor = color1 * color1 + color2 * color2;
    finalColor *= _DustColor.rgb;

    return finalColor;
}
```

---

è¡¨å±‚uvä¸ç›´æ¥ç”¨dustUV - è¡¨å±‚çš„ç°å°˜å¹¶ä¸æ˜¯å®Œå…¨è´´åˆåœ¨ç‰©ä½“çš„è¡¨é¢ä¸Šï¼Œè€Œæ˜¯ä¸ç‰©ä½“çš„å®é™…è¡¨é¢æœ‰ä¸€å®šçš„åç§»é‡ã€‚è¿™ç§åç§»é‡å¯ä»¥ç”¨ viewUV æ¥æ¨¡æ‹Ÿï¼Œå®ƒè®©è¡¨å±‚çš„ç°å°˜çœ‹èµ·æ¥åƒæ˜¯æµ®åœ¨ç‰©ä½“è¡¨é¢ä¹‹ä¸Šï¼Œè€Œä¸æ˜¯ä¸¥æ ¼åœ°è´´åœ¨ç‰©ä½“è¡¨é¢ä¸Š

`_DustDepthShift` å’Œ `_DustLayerBetween` æ˜¯ä¸¤ä¸ªä¸åŒç»´åº¦çš„æ§åˆ¶é¡¹ï¼š- `_DustDepthShift` è´Ÿè´£æ•´ä½“çš„æ·±åº¦æ„Ÿ ï¼ˆåŒ…æ‹¬ å†°é¢ä¸è¡¨å±‚æ‚å¿—çš„æ·±åº¦å·® ä»¥åŠ è¡¨å±‚æ‚è´¨ä¸æ¬¡è¡¨å±‚æ‚è´¨çš„æ·±åº¦å·®ï¼‰- `_DustLayerBetween` è´Ÿè´£å±‚é—´çš„è§†è§‰å·®å¼‚ ï¼ˆæŒ‡è¡¨å±‚æ‚è´¨ä¸æ¬¡è¡¨å±‚æ‚è´¨ä¹‹é—´çš„æ·±åº¦å·®ï¼‰

<br></br>
**~~åšåº¦~~**

åšåº¦åˆ†æ

<img
	src='/assets/Effects/Ice/img26.png'
	alt='img26'
	style='width: 40%; height: auto; display:block; margin: 0 auto;'
/>

- è®¡ç®—ç‰©ä½“åšåº¦çš„æ€è·¯æ˜¯é€šè¿‡å°„çº¿æ±‚ç‰©ä½“äº¤ç‚¹ã€‚
- å‡è®¾Aæ˜¯å°„çº¿è¿›å…¥ç‰©ä½“çš„ç‚¹ï¼ŒBæ˜¯å°„çº¿å°„å‡ºç‰©ä½“çš„ç‚¹ï¼Œé‚£ä¹ˆABçš„è·ç¦»å°±æ˜¯ç‰©ä½“çš„åšåº¦ã€‚
- æ˜¾ç¤ºå‡ ä½•ä½“å¾ˆè®¡ç®—äº¤ç‚¹ï¼Œä½¿ç”¨ç»éªŒæ¨¡å‹ä¼°ç®—åšåº¦

---

ä¼°ç®—åšåº¦çš„ç»éªŒæ¨¡å‹

- è®¡ç®—åšåº¦çš„æ€è·¯ä»ç„¶æ˜¯é€šè¿‡å°„çº¿ä¸ç‰©ä½“ç›¸äº¤
- ä»¥ _çƒä½“_ æ¥æ¨¡æ‹Ÿç‰©ä½“ï¼Œæ±‚å°„çº¿ä¸è¯¥çƒä½“ç›¸äº¤çš„æ–¹å¼æ¥æ¨¡æ‹Ÿç‰©ä½“åšåº¦

---

<img
	src='/assets/Effects/Ice/img27.png'
	alt='img27'
	style='width: 40%; height: auto; display:block; margin: 0 auto;'
/>

- å‡è®¾è§†çº¿å°„å‘ç‰©ä½“è¡¨é¢ä¸€ç‚¹Pï¼Œåœ¨Pç‚¹æ²¿ _æ³•çº¿ç›¸åæ–¹å‘_ è·ç¦»Rçš„ä¸€ç‚¹ä½œä¸ºçƒå¿ƒï¼Œä½œä¸€ä¸ªçƒä½“ï¼Œçƒä½“åŠå¾„ä¸º R
- çƒä½“ã€ç‰©ä½“è¡¨é¢ã€å°„çº¿ä¸‰ç‚¹äº¤äº P
- _å°„çº¿ç»è¿‡çƒä½“çš„è·ç¦»_ ä¸ºç‰©ä½“åœ¨ P ç‚¹å¤„çš„åšåº¦

<br></br>
**~~å°„çº¿ä¸çƒä½“ç›¸äº¤~~**

**ä»£æ•°æ³•**

<img
	src='/assets/Effects/Ice/img28.png'
	alt='img28'
	style='width: 40%; height: auto; display:block; margin: 0 auto;'
/>

$$ b = d \cdot (o-c) $$

$$ c = (o-c) \cdot (o-c) - r^2 $$

$$ t = -b +- sqrt(b^2 - c) $$

---

**å‡ ä½•æ³•**

<img
	src='/assets/Effects/Ice/img29.png'
	alt='img29'
	style='width: 40%; height: auto; display:block; margin: 0 auto;'
/>
<br></br>
<img
	src='/assets/Effects/Ice/img30.png'
	alt='img30'
	style='width: 70%; height: auto; display:block; margin: 0 auto;'
/>

---

**ä»£ç **

```csharp
// t = -b Â± sqrt(b^2 - c)
void IntersectionShere(float3 rayOrigin, float3 rayDirection, float3 position, float radius,
                        out float frontDist, out float backDist, out float thickness)
{
    float3 oc = rayOrigin - position;
    float b = dot(oc, rayDirection);
    float c = dot(oc, oc) - radius * radius;
    float h = b * b - c;
    h = sqrt(h);

    frontDist = -b - h;
    backDist = -b + h;

    // thickness = backDist - frontDist = -b + h - (-b - h) = 2h
    thickness = h * 2.0;
}
```

<br></br>
**~~è®¡ç®—åšåº¦ä»£ç ~~**

é€šè¿‡ä¸€ä¸ª _åŠå¾„ç³»æ•°_ å’Œ _ç‰©ä½“ç¼©æ”¾_ èƒ½æ§åˆ¶æ•´ä½“çš„åšåº¦

- è®¾å®šä¸€ä¸ª _å½’ä¸€åŒ–çš„æ–¹å‘å‘é‡_ ï¼ŒæŠŠå®ƒä»ç‰©ä½“ç©ºé—´è½¬æ¢æˆ _ä¸–ç•Œç©ºé—´_ ï¼Œå†æ±‚è¿™ä¸ªæ–¹å‘å‘é‡çš„é•¿åº¦ï¼Œè¿™æ ·å°±å¾—å‡ºç‰©ä½“çš„ç¼©æ”¾å‚æ•°
- å½“ç‰©ä½“ç¼©å°æ—¶åšåº¦å˜å°ï¼Œç‰©ä½“æ”¾å¤§æ—¶åšåº¦å˜å¤§ï¼Œè¿™æ ·å°±èƒ½éå¸¸æ–¹ä¾¿åœ°æ§åˆ¶ç‰©ä½“åšåº¦æ•°å€¼
- ä¹Ÿå°±æ˜¯è¯´ _é€šè¿‡è¿™ä¸ªå‘é‡çš„é•¿åº¦å˜åŒ–æ¥æ˜ å°„ç‰©ä½“çš„ç¼©æ”¾_

---

è®¡ç®—ä¸¤ç‚¹ä¹‹é—´è·ç¦»

```csharp
// ä»çƒä½“ç›¸äº¤è¡ç”Ÿå‡ºæ¥çš„æ–¹æ³•
void IntersectionMesh(float3 rayOrigin, float3 rayDirection, float radius, IceInputData inputData, out float thickness)
{
    // Shading Point æ²¿æ³•çº¿åæ–¹å‘ä»¥åŠå¾„ radius é•¿åº¦åç§»ï¼Œå¾—å‡ºçƒå¿ƒ
    float3 offsetPosWS = inputData.positionWS - inputData.vertexNormalWS * radius;
    float3 oc = rayOrigin - offsetPosWS;
    float b = dot(rayDirection, oc);
    float c = dot(oc, oc) - radius * radius;
    float h = b * b - c;
    h = sqrt(h);

    thickness = h * 2;
}
```

---

è·å–ç‰©ä½“ç¼©æ”¾å€¼

```csharp
float3 ObjectScale()
{
    float3 output = 0;

    // å°†å½’ä¸€åŒ–å‘é‡ä»OSè½¬æ¢åˆ°WSï¼Œ falseè¡¨ç¤ºä¸ä¸normalize
    float3 worldDir = TransformObjectToWorldDir(float3(1,0,0), false);
    output.x = length(worldDir);
    worldDir = TransformObjectToWorldDir(float3(0,1,0), false);
    output.y = length(worldDir);
    worldDir = TransformObjectToWorldDir(float3(0,0,1), false);
    output.z = length(worldDir);
    return output;
}
```

---

æœ€ç»ˆæ±‚ç‰©ä½“åšåº¦çš„å‡½æ•°

```csharp
float ShapeVolume(IceInputData inputData)
{
    // è§‚æµ‹ç‚¹ä½ç½®
    float3 rayOrigin = inputData.cameraPosition;
    // è§†çº¿æ–¹å‘
    float3 rayDirection = -inputData.viewDirectionWS;

    // å½“å‰å®é™…çƒä½“åŠå¾„ = åŠå¾„ç³»æ•° * ç‰©ä½“ç¼©æ”¾
    float radius = _ShapeSphereRadius * ObjectScale().x;

    // æ±‚è¯¥åŠå¾„ä¸‹çš„çƒä½“åšåº¦
    float thickness = 0;
    IntersectionMesh(rayOrigin, rayDirection, radius, inputData, thickness);

    return thickness;
}
```

<br></br>
**~~é›¾~~**

åšåº¦ä¸èƒ½ç›´æ¥æ¸²æŸ“å‡ºæ¥ï¼Œå¿…é¡»é€šè¿‡è½¬æ¢æˆå…‰çš„èƒ½é‡æ‰èƒ½è¢«æ¸²æŸ“ã€‚

- é›¾è¶Šåšï¼Œå…‰çº¿æ•£å°„å°±è¶Šå‰å®³ï¼Œé›¾ä¸æ‚è´¨çš„åŸºæœ¬è‰²ç›¸ä¹˜ï¼Œé‚£ä¹ˆå°±æ˜¯æœ€ç»ˆæ‚è´¨çš„æ•ˆæœäº†
- è¿™é‡Œçš„é›¾æŒ‡çš„æ˜¯ï¼Œå†°å—å†…éƒ¨çš„æ¨¡ç³Šæ•ˆæœ

---

**ä»£ç **
é›¾æ•ˆå…¬å¼æ¥è‡ª D3D çš„ Fog æ¨¡å‹ - é€šè¿‡ _åšåº¦å’Œå¯†åº¦_ è®¡ç®—é›¾

```csharp
float ExponentialDensity(float depth, float density, bool useExp2)
{
    // D3DFOG_EXP   f = 1/ e ^ (depth * density)
    // D3DFOG_EXP2  f = 1/ e ^ ((depth * density)^2)
    float value = depth * density;
    value = useExp2 ? value * value : value;

    value = pow(2.718, value);
    value = 1 / value;

    // æ·±åº¦å°äº0åˆ™è·³è¿‡
    if (depth <= 0) value = 1;

    return value;
}
```

<br></br>
**~~æœ€ç»ˆæ‚è´¨æ•ˆæœ~~**

```csharp
// Thickness
float thickness = ShapeVolume(inputData);
thickness = max(0, thickness);

// Fog
half fog = ExponentialDensity(thickness + _FogBase, _FogDensity, _UseFogExp2);
fog = 1 - saturate(fog);

// Dust Color
half4 dustColor = 1;
dustColor.rgb = EffectDust(input, inputData) + _FogColor.rgb;
dustColor.rgb *= fog;
dustColor.a = fog;
```

<br></br>
#### æ•£å°„æœ€ç»ˆç»“æœ **~~AlphaBlending~~**

æ··åˆä¸¤ç§é¢œè‰²

```csharp
// Premultiply Mode
half4 AlphaBlending(half4 srcColor, half4 dstColor)
{
    half4 finalColor;
    half oneMinutesAlpha = 1 - srcColor.a;
    finalColor = srcColor + oneMinutesAlpha * dstColor;
    return finalColor;
}
```

<br></br>
**~~æ··åˆè£‚ç¼ä¸æ‚è´¨é¢œè‰²~~**

```csharp
half4 DiffuseEffect(Varyings input, IceInputData inputData)
{
    // Thickness
    float thickness = ShapeVolume(inputData);
    thickness = max(0, thickness);

    // Fog
    half fog = ExponentialDensity(thickness + _FogBase, _FogDensity, _UseFogExp2);
    fog = 1 - saturate(fog);

    // Dust Color
    half4 dustColor = 1;
    dustColor.rgb = EffectDust(input, inputData) + _FogColor.rgb;
    dustColor.rgb *= fog;
    dustColor.a = fog;

    // Cracks Color
    float depthCracks = EffectCracks(input, inputData);
    half4 cracksColor = _CracksColor;
    cracksColor.a *= depthCracks;
    cracksColor.rgb *= cracksColor.a;

    // Blend Cracks and Dust
    half4 cracksDustColor = AlphaBlending(cracksColor, dustColor);

    return cracksDustColor;
}
```

æ•ˆæœï¼š

<img
	src='/assets/Effects/Ice/img31.png'
	alt='img31'
	style='width: 40%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>
**~~æ•£å°„é¢œè‰²~~** è£‚ç¼ä¸æ‚è´¨é¢œè‰²å†åŠ ä¸€å±‚è¡¨é¢çš„é¢œè‰²ç»†èŠ‚ï¼Œå°±å®Œæˆäº†æ•´ä¸ªæ•£å°„åˆæˆéƒ¨åˆ†

---

Glass

```csharp
half4 EffectGlass(Varyings input)
{
    half glassAlpha = tex2D(_GlassTexture, input.uv0.xy).r * _GlassColor.a;
    half4 glassColor = half4(_GlassColor.rgb * glassAlpha, glassAlpha);

    return glassColor;
}
```

---

Diffuse

```csharp
half4 DiffuseEffect(Varyings input, IceInputData inputData)
{
    // Thickness
    float thickness = ShapeVolume(inputData);
    thickness = max(0, thickness);

    // Fog
    half fog = ExponentialDensity(thickness + _FogBase, _FogDensity, _UseFogExp2);
    fog = 1 - saturate(fog);

    // Dust Color
    half4 dustColor = 1;
    dustColor.rgb = EffectDust(input, inputData) + _FogColor.rgb;
    dustColor.rgb *= fog;
    dustColor.a = fog;

    // Cracks Color
    float depthCracks = EffectCracks(input, inputData);
    half4 cracksColor = _CracksColor;
    cracksColor.a *= depthCracks;
    cracksColor.rgb *= cracksColor.a;

    // Blend Cracks and Dust
    half4 cracksDustColor = AlphaBlending(cracksColor, dustColor);

    // Glass
    half4 glassColor = EffectGlass(input);

    // Diffuse
    half4 diffuse = AlphaBlending(glassColor, cracksDustColor);

    return diffuse;
}
```

<img
	src='/assets/Effects/Ice/img32.png'
	alt='img32'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>

### åˆæˆ

#### æ•£å°„ã€åå°„ã€æŠ˜å°„ä¸‰è‰²æ··åˆ

**~~æ··åˆé€»è¾‘~~**

**åå°„ä¸æŠ˜å°„**

- ç”±äºBRDFå’ŒBTDFåˆ†åˆ«è€ƒè™‘äº†åå°„å’ŒæŠ˜å°„æ–¹å‘ä¸Šçš„å…‰çº¿åˆ†å¸ƒï¼Œå®ƒä»¬å·²ç»å°†å…¥å°„å…‰çº¿åœ¨è¡¨é¢å‘ç”Ÿçš„åå°„å’ŒæŠ˜å°„çš„ç‰©ç†è¡Œä¸ºè€ƒè™‘åœ¨å†…ã€‚å½“ä½ åœ¨åœºæ™¯ä¸­ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œå®é™…ä¸Šå·²ç»éšå«äº† _èƒ½é‡å®ˆæ’_ çš„è¦æ±‚
- BRDF å’Œ BTDF åˆ†åˆ«ä»£è¡¨äº†åå°„å’ŒæŠ˜å°„å…‰çš„æ¯”ä¾‹

---

**æ•£å°„**

- æ•£å°„ä¸åå°„ã€æŠ˜å°„ä¸åŒï¼Œå®ƒé€šå¸¸æ˜¯é€šè¿‡æ¨¡æ‹Ÿç¯å¢ƒå…‰çš„æ–¹å¼æ¥å¤„ç†ï¼Œç±»ä¼¼äºå…‰çº¿åœ¨å¤šæ¬¡ç¢°æ’åæ²¿éšæœºæ–¹å‘ä¼ æ’­ã€‚ç”±äºå®ƒä¸åŸºäºBRDF/BTDFçš„ç²¾ç¡®å…‰çº¿åˆ†å¸ƒæ¨¡å‹ï¼Œ _åªæ˜¯ç®€å•æ¨¡æ‹Ÿç¯å¢ƒå…‰çš„åˆ†å¸ƒ_ ï¼Œå› æ­¤ç›´æ¥å’ŒBRDF/BTDFç›¸åŠ å¹¶ä¸åˆé€‚ã€‚

---

**ä¸‰è€…æ··åˆ**

- ä» _èƒ½é‡å®ˆæ’_ çš„è§’åº¦æ¥çœ‹ï¼Œå…‰çº¿æ€»èƒ½é‡çš„åˆ†å¸ƒåº”è¯¥åœ¨ _åå°„ã€æŠ˜å°„å’Œæ•£å°„_ ä¸‰éƒ¨åˆ†ä¸­åˆç†åˆ†é…
- é€šè¿‡ AlphaBlending çš„æ··åˆæ–¹å¼ä½¿å¾—ä¸‰è€…éµå¾ª _èƒ½é‡å®ˆæ’_ å®šå¾‹

---

**å…¥å°„å…‰èƒ½ = åå°„å…‰èƒ½ +ï¼ˆ æ•£å°„å…‰èƒ½ + æŠ˜å°„å…‰èƒ½ï¼‰**

$$ æ•£å°„å’ŒæŠ˜å°„çš„èƒ½é‡æ€»å’Œ = \alpha * æ•£å°„èƒ½é‡ + ï¼ˆ1-\alphaï¼‰*æŠ˜å°„èƒ½é‡ $$

**~~ä»£ç ~~**

æœ€ç»ˆåˆæˆ

```csharp
// æœ€ç»ˆåˆæˆ
void CombinedEffects(Varyings input, IceInputData inputData, out half3 color)
{
    // Diffuse æ¼«åå°„ä¸æ•£å°„
    half4 diffuse = DiffuseEffect(input, inputData);

    // Reflection åå°„
    half4 reflection = EffectReflection(inputData);

    // Refraction æŠ˜å°„ = æŠ˜å°„èƒ½é‡ * (1-a) ç¡®ä¿èƒ½é‡å®ˆæ’
    // reflection.a å­˜å‚¨çš„æ˜¯fresnel, å·²è€ƒè™‘BRDF
    // refelection.rgb ä¹Ÿæ˜¯å·²ç»å’Œaç›¸ä¹˜çš„ç»“æœ
    half4 refraction = EffectRefraction(inputData) * (1-reflection.a);

    // FinalColor
    color = AlphaBlending(diffuse, refraction).rgb;
    color += reflection.rgb;
}
```

<LocalVideo src='/assets/Effects/Ice/video2.mp4' alt='video1' />

<br></br>
### ç›¸å…³èµ„æº å®æ—¶æ¸²æŸ“ç¬¬å››ç‰ˆ- å°„çº¿/çƒä½“ç›¸äº¤ - https://zhuanlan.zhihu.com/p/405042067

å…‰çº¿è·Ÿè¸ªçš„å‡ ç§å¸¸è§æ±‚äº¤è¿ç®—å°„çº¿è¿½è¸ªç®—æ³•-CSDNåšå®¢

- https://blog.csdn.net/qq_39300235/article/details/105232626

URPå†°Shader

- https://learn.u3d.cn/tutorial/urp-ice-shader
