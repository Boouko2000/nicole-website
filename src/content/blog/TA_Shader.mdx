---
heroImage: /src/assets/images/cover_TA_Shader.png
category: æŠ€æœ¯ç¾æœ¯å­¦ä¹ 
description: æŠ€æœ¯ç¾æœ¯æ¸²æŸ“åŸºç¡€ä¸Unityç€è‰²è¯­è¨€å­¦ä¹ 
pubDate: 2025-02-25T16:00:00.000Z
tags:
  - Shaderè¯­è¨€ä¸æ¸²æŸ“åŸºç¡€
title: Unity å¼•æ“ä¸æŠ€æœ¯ç¾æœ¯ç†è®º
---

_[ç¬”è®°æ­£åœ¨æ¬è¿ä¸­...]_

åŸç½‘å€ï¼š https://l186weha4kz.feishu.cn/wiki/EuPpwBhGHiAWupkN2sLc3BLmnnb

### å­¦ä¹ ç¬”è®°

#### æ¸²æŸ“è·¯å¾„

**~~1. æ¸²æŸ“è·¯å¾„ä»‹ç»~~**

æ¸²æŸ“è·¯å¾„ä»£è¡¨ä¸åŒçš„*ä¸ºè¿›è¡Œå…‰ç…§è®¡ç®—è€Œè®¾è®¡çš„*æ¸²æŸ“æ–¹å¼

æ¸²æŸ“è·¯å¾„åˆ†ç±»

- å‰å‘æ¸²æŸ“è·¯å¾„ Forward Rendering Path
- å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ Deferred Renering Path
- é¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„ Vertex Lit Rendering Path (deprecated)

<br></br>
**~~2. å‰å‘æ¸²æŸ“è·¯å¾„~~**

**å‰å‘æ¸²æŸ“åŸºç¡€ä»‹ç»**

å‰å‘æ¸²æŸ“æµç¨‹

- å¯¹äºåœºæ™¯ä¸­çš„æ¯ä¸€ä¸ªå…‰æºï¼Œè®¡ç®—è¯¥å…‰æºå¯¹æ¯ä¸€ä¸ªç‰©ä½“çš„å…‰ç…§æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªç‚¹å…‰æºï¼Œä¼šè®¡ç®—å…‰çº¿ä»å…‰æºä½ç½®åˆ°ç‰©ä½“è¡¨é¢çš„æ–¹å‘ï¼Œæ ¹æ®å…‰æºçš„å¼ºåº¦ã€é¢œè‰²ï¼Œç‰©ä½“çš„æè´¨å±æ€§ç­‰æ¥è®¡ç®—å…‰ç…§çš„è´¡çŒ®ã€‚
- è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬è®¡ç®—æ¼«åå°„å…‰ç…§ï¼ˆåŸºäºå…°ä¼¯ç‰¹ä½™å¼¦å®šå¾‹ï¼‰ã€é«˜å…‰å…‰ç…§ï¼ˆå¦‚ä½¿ç”¨ Phong æˆ– Blinn - Phong å…‰ç…§æ¨¡å‹ï¼‰ç­‰ã€‚
- å¦‚æœæœ‰å¤šä¸ªå…‰æºï¼Œå°±ä¼šä¾æ¬¡è®¡ç®—æ¯ä¸ªå…‰æºå¯¹ç‰©ä½“çš„å…‰ç…§æ•ˆæœï¼Œç„¶åå°†è¿™äº›å…‰ç…§æ•ˆæœå åŠ èµ·æ¥ï¼Œå¾—åˆ°ç‰©ä½“æœ€ç»ˆçš„å…‰ç…§é¢œè‰²ã€‚

---

å‰å‘æ¸²æŸ“çš„ä¼˜ç‚¹

- å‰å‘æ¸²æŸ“çš„*æ€§èƒ½æ¶ˆè€—ä¸ç¯å…‰æ•°é‡æŒ‚é’©*ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶ç¯å…‰æ•°é‡æ¥è°ƒæ•´æ€§èƒ½æ¶ˆè€—

---

**Unityä¸­çš„å…‰ç…§æ¸²æŸ“æ¨¡å¼**

- é€åƒç´ å…‰ç…§
- é€é¡¶ç‚¹å…‰ç…§
- çƒè°å‡½æ•°å…‰ç…§

<img
	src='/assets/TA/Shader/img7.png'
	alt='img7'
	style='width: 70%; height: auto; display:block; margin: 0 auto;'
/>

---

**æ­£ç¡®ç†è§£å’Œè¿ç”¨å‰å‘æ¸²æŸ“è·¯å¾„**

è§’è‰²å’Œå…‰æºæ˜¯åŠ¨æ€çš„ï¼Œå¦‚ä½•ä¿æŒå¹³ç¨³å¸§ç‡?

- Unity ä¸­*æ§åˆ¶åƒç´ å…‰çš„æ•°é‡* pixel light count

---

**ForwardBase å’Œ ForwardAdd ä¸¤ä¸ª Pass**

ForwardBase pass:

- *ä¸€ä¸ª*é€åƒç´ çš„ä¸»å…‰æº
- é¡¶ç‚¹å…‰æº
- çƒè°å…‰

```csharp
Tags {"LightMode" = "ForwardBase"}
#pragma multi_compile_fwdbase
```

<br></br>

ForwardAdd pass:

- é€åƒç´ çš„å…¶ä»–éä¸»å…‰æº

```csharp
Tags {"LightMode" = "ForwardAdd"}
Blend one one
#pragma multi_compile_fwdadd
```

---

**Unity å¯¹å…‰ç…§æ¸²æŸ“ç±»å‹çš„åˆ¤æ–­**

- è§„åˆ™ä¸€ï¼šåœºæ™¯ä¸­*æœ€äº®çš„å¹³è¡Œå…‰*æ€»æ˜¯æŒ‰*é€åƒç´ *å¤„ç†çš„
- è§„åˆ™äºŒï¼šæ¸²æŸ“æ¨¡å¼è¢«è®¾ç½®ä¸º N*ot Important* çš„å…‰æºï¼Œä¼šæŒ‰*é€é¡¶ç‚¹æˆ–çƒè°*å¤„ç†
- è§„åˆ™ä¸‰ï¼šæ¸²æŸ“æ¨¡å¼è¢«è®¾ç½®ä¸º _Important_ çš„å…‰æºï¼Œä¼šæŒ‰*é€åƒç´ *å¤„ç†
- è§„åˆ™å››ï¼šå¦‚æœæ ¹æ®ä»¥ä¸Šè§„åˆ™å¾—åˆ°çš„é€åƒç´ å…‰æºæ•°é‡å°äº Quality setting ä¸­çš„é€åƒç´ å…‰æºæ•°é‡ï¼Œä¼šæœ‰æ›´å¤šçš„ç¯å…‰ä»¥é€åƒç´ çš„æ–¹å¼æ¸²æŸ“

<br></br>
**~~3. å»¶è¿Ÿæ¸²æŸ“è·¯å¾„~~**

**å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä»‹ç»**

å»¶è¿Ÿæ¸²æŸ“æ˜¯å°†*ç€è‰²è®¡ç®—å»¶å*çš„ä¸€ç§æ¸²æŸ“æ–¹å¼

å»¶è¿Ÿæ¸²æŸ“è·¯å¾„åŒ…å«ä¸¤ä¸ªpass

- _G-Buffer Pass_ : å‡ ä½•å¤„ç†
- _Lighting Pass_: å…‰ç…§å¤„ç†

---

**G-Buffer Pass å‡ ä½•å¤„ç†**

å°†ä¸åŒçš„æ¸²æŸ“ç»“æœå‚¨å­˜åœ¨Multiple Render Target(2Då›¾ç‰‡)ä¸­

- RT0: Diffuse Color(RGB) + Occlusion(A)
- RT1: Specular Color(RGB) + Roughness(A)
- RT2: World Space Normal (RGB)
- RT3: non-HDR or HDR related information
- RT4: Light Occlusion å¼€å¯é˜´å½±æ—¶æ‰æœ‰è¿™å¼ è´´å›¾
- Depth + Stencil Buffer

---

**Lighting Pass å…‰ç…§å¤„ç†**

- åªéœ€æ¸²æŸ“å‡ºä¸€ä¸ªå±å¹•å¤§å°çš„äºŒç»´çŸ©å½¢ï¼Œä½¿ç”¨ç¬¬ä¸€æ­¥åœ¨G-bufferä¸­å‚¨å­˜çš„æ•°æ®å¯¹æ­¤çŸ©é˜µçš„æ¯ä¸€ä¸ªç‰‡å…ƒè¿›è¡Œè®¡ç®—å…‰ç…§

---

**å»¶è¿Ÿæ¸²æŸ“çš„ä¼˜ç¼ºç‚¹**

ä¼˜ç‚¹ - å½±å“ä¸€ä¸ªç‰©ä½“çš„*å…‰æºæ•°é‡æ˜¯æ²¡æœ‰é™åˆ¶*çš„ï¼Œæ— è®ºæ˜¯å¤šå°‘ä¸ªå…‰æºï¼Œéƒ½æ˜¯ä¸¤ä¸ªpassè®¡ç®— - æ¯ä¸€ä¸ªå…‰æºéƒ½æ˜¯*é€åƒç´ çº§åˆ«*çš„ï¼Œå¯ä»¥æ­£ç¡®è®¡ç®—æ³•çº¿è´´å›¾åŠé˜´å½±

ç¼ºç‚¹ - _ä¸æ”¯æŒåŠé€æ˜æ•ˆæœ_ - _ä¸æ”¯æŒæŠ—é”¯é½¿_ - *å†…å­˜*å¼€é”€å¤§ - ä¸æ”¯æŒæ­£äº¤ç›¸æœº

---

**å»¶è¿Ÿæ¸²æŸ“è·¯å¾„çš„æ”¯æŒæ¡ä»¶**

æ˜¾å¡æ”¯æŒMultiple Rendering Targets(MRT)

ShadeModel 3.0 +

æ‰‹æœºå¹³å°åœ¨ OpenGL3.0 +

<br></br>
**~~4. é¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„~~**

**é¡¶ç‚¹ç…§æ˜æ¸²æŸ“çš„ä¼˜ç¼ºç‚¹**

_Deprecated_

---

ä¼˜ç‚¹ï¼š

- _æ€§èƒ½æœ€ä¼˜_
- æ”¯æŒçš„ç¡¬ä»¶æœ€å¹¿
- ä¸€ä¸ªç‰©ä½“åªæ¸²æŸ“ä¸€æ¬¡ï¼ˆåªæœ‰ä¸€ä¸ªpassï¼‰ï¼Œå¹¶ä¸”æ‰€æœ‰å…‰ç…§è®¡ç®—åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è¿›è¡Œ

ç¼ºç‚¹

- _æ•ˆæœå·®_
- ä¸æ”¯æŒåƒç´ çº§åˆ«çš„å…‰ç…§æ•ˆæœï¼Œå¦‚é˜´å½±ä¸é«˜è´¨é‡é«˜å…‰
- ä¸èƒ½åœ¨åƒç´ çº§åˆ«é‡‡æ ·æ³•çº¿è´´å›¾

<br></br>
**~~5. LightMode~~**

åœ¨Shader Passä¸­é€šè¿‡ *LightMode Tag*åŒºåˆ†ä¸åŒçš„æ¸²æŸ“è·¯å¾„

```csharp
Pass
{
	Tags {"LightMode" = "ForwardBase" } //å½“å·¥ç¨‹å¤„äºå‰å‘æ¸²æŸ“è·¯å¾„æ—¶ï¼Œè¯¥passè¢«æ‰§è¡Œ
}
```

---

`"LightMode" = "Always"` é»˜è®¤è®¾ç½®ï¼›ä»»ä½•æƒ…å†µä¸‹è¿™ä¸ªpasséƒ½ä¼šè¢«æ¸²æŸ“ï¼Œæ— æ³•è·å¾—ç¯å…‰ä¿¡æ¯

`"LightMode" = "ForwardBase"` å‰å‘æ¸²æŸ“ä¸­çš„åŸºç¡€pass

`"LightMode" = "ForwardAdd"` å‰å‘æ¸²æŸ“ä¸­çš„é¢å¤–pass

`"LightMode" = "Deferred"` å»¶è¿Ÿæ¸²æŸ“

`"LightMode" = "ShadowCaster"` æ¸²æŸ“å¯¹è±¡çš„shadowmapæˆ–è€…depthTexture

`"LightMode" = "MotionVectors"` è®¡ç®—ç‰©ä½“çš„MotionVectors

<br></br>
**~~6. Unity ä¸­çš„ç¯å…‰ç±»å‹~~**

Directional Light å¹³è¡Œå…‰

- æ— è®ºç¯å…‰ä½ç½®ï¼Œå…‰ç…§è§’åº¦ä¸å˜

Point Light ç‚¹å…‰

- çƒå½¢å…‰ç…§èŒƒå›´ï¼Œä½ç½®ä¸åŒï¼Œå…‰ç…§è§’åº¦ä¸åŒï¼Œå…‰ç…§æœ‰è¡°å‡

Spot Light èšå…‰ç¯

- åœ†é”¥ä½“å…‰ç…§èŒƒå›´

Area Light é¢å…‰ç¯

- ä»…ç”¨äºçƒ˜ç„™ï¼Œæ²¡æœ‰å®æ—¶æ•ˆæœ

<br></br>
**~~7. ä¸åŒæ¸²æŸ“è·¯å¾„çš„å¯¹æ¯”ä¸é€‰~~**

<img
	src='/assets/TA/Shader/img8.png'
	alt='img8'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>
#### ç¼“å†²åŒº

**~~1. å¸§ç¼“å†²åŒº~~**

å­˜æ”¾ä¸€å¸§ä¸­çš„æ•°æ®ä¿¡æ¯

å¯ä»¥å†™å…¥æˆ–è¯»å–å¸§ç¼“å­˜ä¸­çš„å†…å®¹

å¸§ç¼“å†²æ–¹å¼

- å•ç¼“å†²ï¼šfragment shader - front buffer - screen
- åŒç¼“å†²: fragment shader - back buffer - (å…‰æ …æ‰«ææ˜¾ç¤ºå™¨) - front buffer - screen

<br></br>
**~~2. é¢œè‰²ç¼“å†²åŒº~~**

**å¸§ç¼“å†²åŒºä¸­åˆ†ä¸ºå¤šä¸ªä¸åŒçš„å­ç¼“å†²åŒº**

- Color Buffer å­˜å‚¨æ¯ä¸€å¸§é¢œè‰²ä¿¡æ¯çš„ç¼“å†²åŒº
- Depth Buffer
- Stencil Buffer
- è‡ªå®šä¹‰ç¼“å†²åŒº

---

**æ˜¾å­˜å ç”¨çš„è®¡ç®—**

<img
	src='/assets/TA/Shader/img9.jpg'
	alt='img9'
	style='width: 70%; height: auto; display:block; margin: 0 auto;'
/>

- 1920 \* 1080 åˆ†è¾¨ç‡çš„é¢œè‰²ç¼“å†²æ‰€å ç”¨çš„æ˜¾å­˜
- 1920 _ 1080 _ 3(3byte) /1024 /1024 = 5.93MB

<br></br>
#### ç»éªŒå…‰ç…§æ¨¡å‹

**~~1. Lambert å…‰ç…§æ¨¡å‹~~**

**Lambert å…‰ç…§æ¨¡å‹å…¬å¼**

> ğŸ“£ **$$ Diffuse = Ambient + K_d * LightColor*dot(N,L) $$**

- Diffuse: æœ€ç»ˆç‰©ä½“ä¸Šçš„æ¼«åå°„
- Ambientï¼šç¯å¢ƒå…‰
- Kdï¼šæè´¨å¯¹å…‰çš„åå°„ç³»æ•°(è¡¨ç¤ºè¯¥æè´¨ä¼šå¸æ”¶å¤šå°‘æ¯”ä¾‹çš„å…‰) [0,1]
- LightColorï¼šå…‰æºé¢œè‰²
- N: é¡¶ç‚¹å•ä½æ³•çº¿å‘é‡
- Lï¼šé¡¶ç‚¹æŒ‡å‘å…‰æºçš„å•ä½å‘é‡

ä¸€ä¸ªç‰©ä½“æœ€ç»ˆçœ‹èµ·æ¥æ˜¯ä»€ä¹ˆé¢œè‰²æ˜¯ç”± diffuse color ä»¥åŠ intrinsic color ï¼ˆå›ºæœ‰è‰²ï¼‰å…±åŒå†³å®šçš„

<br></br>
**~~2. å…‰å¼ºä¸ç¯å¢ƒè‰²~~**

Unityä¸­è·å–ç¯å¢ƒä¸­çš„ç¯å…‰

```csharp
Pass
{
  Tags {"LightMode" = "ForwardBase"}
  #include "Lighting.cginc"
}
```

```csharp
_LightColor0 //ä¸»å¹³è¡Œç­‰çš„é¢œè‰²å€¼ (rgb = é¢œè‰²*intensity; a = intensity)
_WorldSpaceLightPos0 // ç¯å…‰ä½ç½®
unity_WorldToLight //ä»ä¸–ç•Œç©ºé—´è½¬æ¢åˆ°ç¯å…‰ç©ºé—´ä¸‹
```

```csharp
unity_AmbientSKy //Environemnt Lightingè®¾ç½®ï¼šç¯å¢ƒå…‰ä¸­çš„Sky Color
unity_AmbientEquator //Environemnt Lightingè®¾ç½®ç¯å¢ƒå…‰ä¸­çš„Equator color
unity_AmbinetGround //Environemnt Lightingè®¾ç½®ç¯å¢ƒå…‰ä¸­çš„ Ground color
UNITY_LIGHTMODEL_AMBIENT //ç¯å¢ƒå…‰ä¸­çš„é¢œè‰²
```

<br></br>
**~~3. Lambertå…‰ç…§çš„å®ç°~~**

```csharp
Properties
{
  _DiffuseIntensity("Diffuse Intensity", float) = 1
}
Pass
{
  float _DiffuseIntensity;

  float4 frag(v2f i) : SV_Target
  {
  //Diffuse = ambient + Kd * LightColor * dot(N,L)
    fixed4 ambient = UNITY_LIGHTMODEL_AMBIENT:
    fixed4 lightColor = _LightColor0;
    float4 diffuse = ambient + _DiffuseIntensity * _LightColor * max(0,dot(v.normal, _WorldSpaceLightPos0))

    return diffuse;
  }
}
```

<br></br>
**~~4. ä¸åŒç¯å…‰ç±»å‹çš„æ”¯æŒä¸åŒºåˆ†~~**

```csharp
#pragma multi_compile fwadd
Pass
{
  Tags {"LightMode" = "ForwardBase"}
  //å¤„ç†ä¸»å¹³è¡Œå…‰å’Œå…¶ä»–é€é¡¶ç‚¹ä»¥åŠSHå…‰ç…§
}

Pass
{
  Tags {"LightMode" = "ForwardAdd"}

  #if POINT // æˆ–æ˜¯å…¶ä»–ç¯å…‰ç±»å‹
    // ...
  #nedif
}
```

<br></br>
**~~5. å…‰ç…§çš„è¡°å‡~~**

Unityä¸­ä¸€èˆ¬æ˜¯é€šè¿‡é‡‡æ ·ä¸€å¼ *éçº¿æ€§æ¸å˜å…‰ç…§è´´å›¾*è®¡ç®—å…‰å¼º

- å¯¹äºç‚¹å…‰æºç­‰æœ‰å…‰ç…§è¡°å‡çš„å…‰æºæ¥è¯´ï¼Œä»–ä»¬æœ‰å†…ç½®çš„å…‰ç…§çº¹ç†ï¼ˆ1Dï¼‰ï¼Œæ˜¯ä¸€å¼ éçº¿æ€§æ¸å˜é»‘ç™½è´´å›¾
- é€šè¿‡ _é¡¶ç‚¹åˆ°å…‰æºçš„è·ç¦»çš„å¹³æ–¹å€¼_ å¯¹å…‰ç…§çº¹ç†è¿›è¡Œé‡‡æ ·

```csharp
#include "AutoLight.cginc"
Pass
{
  Tags {"LightMode" = "ForwardAdd"} //fwaddå¤„ç†å¸¦è¡°å‡çš„å…‰æºçš„é€åƒç´ è®¡ç®—
  sampler2D _LightTexture0; //Unityå†…ç½®çš„å…‰ç…§çº¹ç†

  float4 frag (v2f v) : SV_Target
  {
    //å…‰æºç©ºé—´ä¸‹é¡¶ç‚¹çš„ä½ç½®ä¿¡æ¯
    float4 lightCoord = mul(unity_WorldToLight,i.pos)

    //é‡‡æ ·å…‰ç…§è´´å›¾
    fixed atten = tex2D(_LightTexture0, dot(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL
  }
}
```

- dot (lightCoord, lightCoord) é¡¶ç‚¹åˆ°å…‰æºçš„å‘é‡ç‚¹ä¹˜è‡ªèº«ï¼Œç»“æœä¸ºè¯¥å‘é‡çš„å¹³æ–¹ï¼Œå³é¡¶ç‚¹åˆ°å…‰æºçš„è·ç¦»çš„å¹³æ–¹
- è™½ç„¶å…‰ç…§çº¹ç†å®é™…æ˜¯ä¸€å¼ 2Dè´´å›¾ï¼Œä½†åªæœ‰1Dçš„ä¿¡æ¯ï¼Œé€šè¿‡rré‡‡æ ·è¯¥2Dçº¹ç†ç›¸å½“äºé€šè¿‡ré‡‡æ ·è¯¥1Dçº¹ç†
- UNITY_ATTEN_CHANNELä»£è¡¨å…‰ç…§çº¹ç†ä¸­ï¼Œè¡°å‡å€¼æ‰€åœ¨çš„åˆ†é‡ï¼ˆè¯¥çº¹ç†è´´å›¾å…¶ä»–åˆ†é‡å¯èƒ½å‚¨å­˜çš„æ˜¯ä¸åŒçš„ä¿¡æ¯ï¼‰

```csharp
UNITY_LIGHT_ATTENUATION(atten, 0, i.worldPos);
// å‡½æ•°çš„å®šä¹‰
#define UNITY_LIGHT_ATTENUATION(destName, input, worldPos)
//destName è¿”å›æœ€åè¡°å‡å˜é‡çš„å˜é‡å
//input ç”¨äºé˜´å½±çš„è®¡ç®—
//worldPos é¡¶ç‚¹ä¸–ç•Œç©ºé—´ä¸‹çš„åæ ‡
```

---

**ç‚¹å…‰æºçš„Pass**

```csharp
Pass
{
  Tags {"LightMode" = "ForwardAdd"}
  Blend One One
  CGPROGRAM
  #pragma vertex vert
  #pragma fragment frag
  #include "Lighting.cginc"
  #include "AutoLight.cginc"
  fixed4 _Color;
  sampler2D _LightTexture0;
  struct appdata
  {
      float4 vertex : POSITION;
      float3 normal : NORMAL;
      float2 uv : TEXCOORD0;
  };
  struct v2f
  {
      float2 uv : TEXCOORD0;
      float4 vertex : SV_POSITION;
      float3 normal : TEXCOORD1;
      float3 worldPos : TEXCOORD2; // Added world position output
  };
  v2f vert (appdata v)
  {
      v2f o;
      o.vertex = UnityObjectToClipPos(v.vertex);
      o.normal = UnityObjectToWorldNormal(v.normal);
      o.uv = v.uv;
      o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz; // Calculate world position
      return o;
  }
  fixed4 frag (v2f i) : SV_Target
  {
      float3 worldNormal = normalize(i.normal);
      float3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz - i.worldPos); // Adjusted for point lights
      UNITY_LIGHT_ATTENUATION(atten, 0 , i.worldPos); // Correctly calculate attenuation
      float4 diffuse = _Color * _LightColor0 * max(0, dot(worldNormal, worldLightDir));
      return diffuse * atten; // Apply attenuation
  }
  ENDCG
}
```

ç‚¹å…‰æºå’Œå¹³è¡Œå…‰ä¸åŒï¼Œä½ç½®å’Œæ–¹å‘éœ€è¦é¢å¤–è®¡ç®—

<br></br>
**~~6. Phong å…‰ç…§æ¨¡å‹~~**

**Phong å…‰ç…§æ¨¡å‹å…¬å¼**

> ğŸ“£ **$$ Specular = SpecularColor * K_S*pow(max(0, dot(R,V)), Glossiness) $$**

- Specular Color : é«˜å…‰é¢œè‰²
- Ks : åå°„ç³»æ•°ï¼ˆå†³å®šé«˜å…‰çš„å¼ºå¼±ï¼‰
- R ï¼š åå°„å…‰å•ä½å‘é‡
- V : ä»é¡¶ç‚¹åˆ°è§‚æµ‹ç‚¹çš„å•ä½å‘é‡
- Gloss : é«˜å…‰æŒ‡æ•°ï¼Œç”¨ä¸æ§åˆ¶é«˜å…‰çš„èŒƒå›´å¤§å°

---

```csharp
Properties
{
  _SpecularColor("Specular Color", Color) = (1,1,1,1)
  _SpecularIntensity("Specular Intensity", float) = 1
  _Glossiness("Glossiness", float) = 10
}
Pass
{
  fixed4 _SpecularColor;
  float _SpecularIntensity
  float _Glossiness
  float4 frag(v2f i) : SV_Target
  {
    // specular term
    fixed V = normalize(_worldSpaceCameraPos - i.worldPos);
    fixed R = reflect(-L, N);
    float4 specular = _SpecularColor * _SpecularIntensity * pow(max(0,dot(R,V)),_Glossiness)
  }

}
```

- å‡ºå°„å…‰æ–¹å‘ R
- R = 2 _ NdotL _ N - L
- `reflect()`

<br></br>
**~~7. Blinn-Phong å…‰ç…§æ¨¡å‹~~**

**Blinn-Phong å…‰ç…§æ¨¡å‹å…¬å¼**

> ğŸ“£ **$$ Specular = SpecularColor * K_S*pow(max(0, dot(N,H)), Glossiness) $$**

- Specular Color : é«˜å…‰é¢œè‰²
- Ks : åå°„ç³»æ•°ï¼ˆå†³å®šé«˜å…‰çš„å¼ºå¼±ï¼‰
- N ï¼šå•ä½æ³•çº¿å‘é‡
- H : åŠç¨‹å‘é‡ï¼ˆå…¥å°„å…‰çº¿Lå’Œè§‚æµ‹æ–¹å‘Vçš„ä¸­é—´å‘é‡ï¼‰
- Gloss : é«˜å…‰æŒ‡æ•°ï¼Œç”¨ä¸æ§åˆ¶é«˜å…‰çš„èŒƒå›´å¤§å°

---

**åŠç¨‹å‘é‡H**

- dot(N, H) ä¸ dot(L, R)æˆæ­£æ¯”ï¼Œåªæ±‚å‰è€…å°±å¯ä»¥æ¨¡æ‹Ÿé«˜å…‰åå°„
- H = normalize(L + V)

---

```csharp
Shader "Unlit/Blinn-Phong"
{
    Properties
    {
        _Color("Color", Color) = (1,1,1,1)
        _DiffuseIntensity("Diffuse Intensity", Range(0,1)) = 1
        _SpecularColor("Specular Color", Color) = (1,1,1,1)
        _SpecularIntensity("Specular Intensity", float) = 1
        _Glossiness("Glossiness", float) = 10
    }
    SubShader
    {
        Tags { "RenderType"="Opaque" }
        Pass
        {
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #include "UnityCG.cginc"
            #include "Lighting.cginc"
            fixed4 _Color;
            float _DiffuseIntensity;
            fixed4 _SpecularColor;
            float _SpecularIntensity;
            float _Glossiness;
            struct appdata
            {
                float4 vertex : POSITION;
                float3 normal : NORMAL;
            };
            struct v2f
            {
                float4 pos : SV_POSITION;
                float3 worldNormal : TEXCOORD0;
                float4 worldPos : TEXCOORD1;
            };
            v2f vert (appdata v)
            {
                v2f o;
                o.pos = UnityObjectToClipPos(v.vertex);
                o.worldNormal = UnityObjectToWorldNormal(v.normal);
                o.worldPos = mul(unity_ObjectToWorld, v.vertex);
                return o;
            }
            fixed4 frag (v2f i) : SV_Target
            {
                // ambient term
                fixed4 ambient = UNITY_LIGHTMODEL_AMBIENT;
                // diffuse term (half-lambertian shading model)
                fixed4 lightColor = _LightColor0;
                float3 N = normalize(i.worldNormal);
                float3 L = _WorldSpaceLightPos0;
                float NdotL = dot(N, L);
                float4 diffuse = lightColor * _DiffuseIntensity * (max(0, NdotL) * 0.5 + 0.5);
                diffuse *= _Color;
                // specular term (blinn-phong shading model)
                float3 V = normalize(_WorldSpaceCameraPos - i.worldPos);
                float3 H = normalize(L + V);
                float4 specular =_SpecularColor * _SpecularIntensity * pow(max(0,dot(N,H)),_Glossiness);
                float4 col = ambient + diffuse + specular;
                return col;
            }
            ENDCG
        }
    }
}
```

<br></br>
#### æ·±åº¦æµ‹è¯•ä¸å†™å…¥

**~~1. æ·±åº¦ç¼“å†²åŒº~~**

æ¯ä¸ªé¡¶ç‚¹çš„æ·±åº¦ä¿¡æ¯ä¼šåœ¨*å…‰æ …åŒ–é˜¶æ®µ*ï¼ˆfragment shaderå‰ï¼‰è¿›è¡Œæ’å€¼å¹¶å‚¨å­˜åˆ°æ·±åº¦ç¼“å†²åŒºä¸­

æ·±åº¦å€¼èŒƒå›´`[0,1]` ,å‘ˆ _éçº¿æ€§_ ï¼ˆè·ç¦»æ‘„åƒæœºè¶Šè¿‘çš„ç‰©ä½“çš„æ·±åº¦å€¼ä¼šæœ‰æ›´é«˜ç²¾åº¦ï¼‰

ä¸é€æ˜ç‰©ä½“æ¸²æŸ“æ—¶æ‰“å¼€æ·±åº¦å†™å…¥ï¼Œ *åŠé€æ˜ç‰©ä½“*æ¸²æŸ“æ—¶*å…³é—­*æ·±åº¦å†™å…¥

---

å¤æ‚åŠé€æ˜ç‰©ä½“åœ¨ä¿è¯æ¸²æŸ“é¡ºåºçš„åŒæ—¶å®ç°åŠé€æ˜æ•ˆæœ

- _ä¸¤ä¸ªPass_ï¼Œä¸€ä¸ªæ‰“å¼€æ·±åº¦å†™å…¥ï¼Œä½†ä¸è¾“å‡ºé¢œè‰²ä¿¡æ¯ã€‚å¦ä¸€ä¸ªå…³é—­æ·±åº¦å†™å…¥ï¼Œè¾“å‡ºé¢œè‰²ä¿¡æ¯ã€‚
- ä¸ç ´åæ·±åº¦æ’åºçš„æƒ…å†µä¸‹ç»˜åˆ¶åŠé€æ˜ç‰©ä½“ï¼Œå¹¶ç¡®ä¿æ­£ç¡®åœ°æ··åˆå®ƒä»¬ä¸å…¶ä»–ä¸é€æ˜ç‰©ä½“ã€‚
- æ¯ä¸ªåŠé€æ˜ä½“éƒ½éœ€è¦è¿›è¡Œä¸¤ä¸ªpassçš„è®¡ç®—ï¼Œæ¶ˆè€—å¤§

```csharp
Pass
{
  ZWrite On
  ColorMask = 0 //ä¸æ˜¾ç¤ºä»»ä½•é¢œè‰²é€šé“ä¿¡æ¯
}
Pass
{
  ZWrite Off
  //æ­£å¸¸å¤„ç†å…‰ç…§å’Œå…¶ä»–æ¸²æŸ“ä¿¡æ¯
}
```

<br></br>
**~~2. æ·±å…¥æµ‹è¯• ZTest~~**

æ·±åº¦å€¼çš„æµ‹è¯•æ“ä½œ

```csharp
ZTest (Less|Greater|LEqua|GEqual|Equal|NotEqual|Never|Always)
// é»˜è®¤ä¸ºLess
```

<br></br>
**~~3. æ·±åº¦åç§» Offset~~**

è·ç¦»ç›¸æœºè¿‘è£å‰ªé¢*è¶Šè¿‘*çš„ç‰©ä½“ï¼ŒZ-valueæ·±åº¦å€¼çš„*ç²¾åº¦*è¶Šé«˜

å½“ä¸¤ä¸ªç‰©ä½“æ·±åº¦å€¼ç›¸åŒæ—¶ï¼Œå åŠ å¯èƒ½ä¼šå‡ºç°æ¸²æŸ“äº¤é”™çš„æ•ˆæœ

- è§£å†³åŠæ³•ä¸€ï¼š å¾®è°ƒå…¶ä¸­ä¸€ä¸ªç‰©ä½“çš„æ·±åº¦ï¼Œå¹¶ä¸”ç¡®ä¿ç›¸æœºè¿‘è£å‰ªé¢ä¸è¦è¿‡å°
- è§£å†³æ–¹æ³•äºŒï¼šä¿æŒä¸¤è€…æ·±åº¦å€¼ç›¸åŒï¼Œä½¿ç”¨*æ·±åº¦åç§»*

æ·±åº¦åç§»*åªæ”¹å˜æ·±åº¦ç¼“å†²ä¸­çš„å€¼*ï¼Œä¸æ”¹å˜æ¨¡å‹å®é™…ä½ç½®

```csharp
Offset Factors, Units
// offset = (m * factor) + (r * units)
// é»˜è®¤å€¼ä¸º 0ï¼Œ0
// Offset > 0, å³å°†ç‰©ä½“å¾€è¿œå¤„æ¨ï¼Œç¦»æ‘„åƒæœºæ›´è¿œ ï¼ˆZå€¼å˜å¤§ï¼‰
```

<br></br>
#### é˜´å½±

**~~1. ShadowMappingçš„åŸç†~~**

<br></br>
**~~2. Unityä¸­é˜´å½±çš„æŠ•å°„ Casting Shadow~~**

<br></br>
**~~3. Unityä¸­é˜´å½±çš„æ¥æ”¶~~**

<br></br>
#### å…‰ç…§ç³»ç»Ÿ

**~~1. LightMapping ç†è®º~~**

**æ¸¸æˆä¸­å…‰ç…§æ¸²æŸ“çš„ç±»å‹**

å®æ—¶å…‰

- åŸç†ï¼šä½œç”¨äºæ¯ä¸€ä¸ªç¯å…‰èŒƒå›´å†…çš„æ¨¡å‹é¡¶ç‚¹ï¼ˆé€é¡¶ç‚¹ã€é€åƒç´ å…‰ç…§ï¼‰
- ä¼˜ç‚¹ ç¯å…‰ä½ç½®ã€å¼ºåº¦ã€é¢œè‰²ä¼šå‘ç”Ÿç§»åŠ¨
- ç¼ºç‚¹ æ¶ˆè€—å¤§ï¼Œä¸æ”¯æŒå…‰çº¿è¿½è¸ª

çƒ˜ç„™å…‰

- åŸç†ï¼šå°†å…‰çº¿åœ¨åœºæ™¯ä¸­å¤šæ¬¡åå°„çš„ç»“æœè®¡ç®—åœ¨ä¸€å¼ å…‰ç…§è´´å›¾ä¸Š
- ä¼˜ç‚¹ å…‰çº¤çš„æ¨¡æ‹Ÿæ•ˆæœçœŸå® / å¼€é”€æ¯”å®æ—¶å…‰å°
- ç¼ºç‚¹ ä¸èƒ½åº”ç”¨äºå®æ—¶ç§»åŠ¨çš„å…‰æºä¸ç‰©ä½“

å®é™…å¼€å‘ä¸­ä¸€èˆ¬æ˜¯ä¸¤ç§å…‰çº¿æ•ˆæœå¹¶ç”¨

- å¯¹äºåŠ¨æ€å…‰æº/åŠ¨æ€ç‰©ä½“ï¼Œé‡‡ç”¨å®æ—¶å…‰
- å¯¹äºé™æ€å…‰æº/é™æ€ç‰©ä½“ï¼Œé‡‡ç”¨çƒ˜ç„™å…‰

---

**å…‰çº¿çš„å…­ç§ç‰¹æ€§**

ç‰©ç†ä¸–ç•Œä¸­å…‰çº¤çš„å…­ç§ç‰¹æ€§

- åå°„ Reflection
  - æ¼«åå°„ï¼šç²—ç³™å¾®è¡¨é¢
  - é•œé¢åå°„ï¼šå…‰æ»‘å¾®è¡¨é¢
- é€å°„ Transmission
- æ•£å°„ Scattering
- æŠ˜å°„ Refraction
- è¡å°„ Diffraction
- å¸æ”¶ Absorption

<img
	src='/assets/TA/Shader/img1.png'
	alt='img1'
	style='width: 70%; height: auto; display:block; margin: 0 auto;'
/>

---

**å…¨å±€å…‰ç…§**

ä»‹ç»

- å…¨å±€å…‰ç…§çº³å…¥äº†å…‰çº¿çš„å¤šæ¬¡åå°„è®¡ç®—è€ƒè™‘ï¼Œå¯ä»¥æ¨¡æ‹Ÿå‡ºéå¸¸çœŸå®çš„ç¯å¢ƒå…‰ç…§
- å…¨å±€å…‰ç…§å¯ä»¥é€šè¿‡ _çƒ˜ç„™å…‰_ å®ç°

Unity ä¸­æä¾›äº†ä¸¤ç§ä¸åŒçš„æŠ€æœ¯æ¥é¢„å…ˆè®¡ç®—å…¨å±€å…‰ç…§å’Œåå°„å…‰ç…§ï¼š

- _é¢„è®¡ç®—å…¨å±€å…‰ç…§ GI - Baked Global Illumination_
  - ä½œç”¨åœ¨é™æ€ç‰©ä½“ä¸Š
- _å®æ—¶å…¨å±€å…‰ç…§ -Realtime Global Illumination_
  - ä½œç”¨åœ¨åŠ¨æ€ç‰©ä½“ä¸Š

Unity ä¸­å®æ—¶å…¨å±€å…‰ç…§çš„è§£å†³æ–¹æ¡ˆ

- Unity Enlighten å…‰ç…§ç³»ç»Ÿ ï¼ˆDeprecatedï¼‰
- _Progressive Light Mapping (CPU/GPU)_

<br></br>
**~~2. Baked GI å®æˆ˜~~**

**åœºæ™¯æ­å»ºä¸æè´¨è®¾ç½®**

åœºæ™¯æ­å»º

- ç¡®ä¿åœºæ™¯ä¸­çš„å‚ä¸çƒ˜ç„™å…‰ç…§è®¡ç®—çš„ç‰©ä½“å’Œç¯å…‰å‹¾é€‰ `static`

---

è‡ªå‘å…‰æè´¨

- èµ‹äºˆå……å½“ç¯å…‰çš„ç‰©ä½“ä¸€ä¸ªè‡ªå‘å…‰æè´¨ï¼ˆEmission HDR color : >1ï¼‰
- Windows - Renering - Lighting - Generate Lighting

---

Lightmap UV

- å¦‚æœæ²¡æœ‰ç‰¹åˆ«é¢å¤–åˆ¶ä½œ LightmapUVï¼Œéœ€è¦åœ¨ mesh çš„é¢æ¿ä¸­å‹¾é€‰ `Generate Lightmap UVs`

<details>
	<summary> ğŸ‘‰ Lightmap UV ä»‹ç»</summary>
	Lightmap UV æ˜¯ä¸€ç§ç‰¹æ®Šçš„ UV
	åæ ‡é›†ã€‚å®ƒä¸“é—¨ç”¨äºå­˜å‚¨å…‰ç…§ä¿¡æ¯ï¼ˆå¦‚é—´æ¥å…‰ã€é˜´å½±ç­‰ï¼‰çš„çº¹ç†æ˜ å°„ã€‚å½“è¿›è¡Œå…‰ç…§çƒ˜ç„™ï¼ˆå¦‚åœ¨æ¸¸æˆå¼€å‘æˆ– 3D
	æ¸²æŸ“ä¸­ï¼‰æ—¶ï¼Œæ¸²æŸ“å™¨ä¼šæ ¹æ®åœºæ™¯ä¸­çš„å…‰ç…§æ¡ä»¶è®¡ç®—æ¯ä¸ªè¡¨é¢æ¥æ”¶çš„å…‰ç…§é‡ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªçº¹ç†ï¼ˆlightmapï¼‰ä¸­
	æ™®é€š UV
	çš„å¸ƒå±€ä¸»è¦è€ƒè™‘å¦‚ä½•æœ€å¥½åœ°å±•ç¤ºæ¨¡å‹çš„çº¹ç†ç»†èŠ‚ï¼Œå¯èƒ½ä¼šæ ¹æ®æ¨¡å‹çš„å½¢çŠ¶å’Œçº¹ç†å›¾æ¡ˆè¿›è¡Œä¼˜åŒ–ï¼›lightmap UV
	çš„å¸ƒå±€æ›´å…³æ³¨å…‰ç…§ä¿¡æ¯çš„å‡†ç¡®æ€§å’Œå‡åŒ€æ€§ï¼Œéœ€è¦ç¡®ä¿å…‰ç…§çº¹ç†èƒ½å¤Ÿæ­£ç¡®åœ°è¦†ç›–æ¨¡å‹è¡¨é¢ï¼Œé¿å…å…‰ç…§æ³„æ¼æˆ–ä¸å‡åŒ€çš„æƒ…å†µã€‚
</details>

---

çƒ˜ç„™æ–‡ä»¶

<img
	src='/assets/TA/Shader/img2.png'
	alt='img2'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

- çƒ˜ç„™ç»“æŸåä¼šåœ¨ä¸åœºæ™¯åŒçº§çš„ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶

<img
	src='/assets/TA/Shader/img3.png'
	alt='img3'
	style='width: 70%; height: auto; display:block; margin: 0 auto;'
/>

---

**æ•ˆæœè¿›é˜¶**

æ¸²æŸ“ç‘•ç–µä¿®å¤

- å½“æ¨¡å‹å¤„äºä¸¤ç›ç¯å…‰çš„ _äº¤ç•Œå¤„_ æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç° _æ¥ç¼æ˜æ˜¾_ çš„æƒ…å†µ
  - Model - Inspector - stitch seam
- å½“åœºæ™¯ä¸­çš„çƒ˜ç„™æ¸²æŸ“ _ç²¾åº¦å¤ªä½_ ï¼Œæ¨¡å‹è¡¨é¢å¯èƒ½ä¼šå‡ºç° _å…‰æ–‘_
  - Lighting - å¢åŠ  lightmap resolution å’Œ lightmap padding

<img
	src='/assets/TA/Shader/img4.png'
	alt='img4'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

---

AO çš„å¼€å¯

- Lighting - Lightingmapping settings - Ambient Occlusion âœ”

<img
	src='/assets/TA/Shader/img5.png'
	alt='img5'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

---

Bloom æ³›å…‰æ•ˆæœ

- _Post Processing_ æ’ä»¶ï¼ˆpackageï¼‰
- ç¡®ä¿æ¸²æŸ“çš„é¢œè‰²ç©ºé—´åœ¨ _çº¿æ€§ç©ºé—´_
  - Project settings -Player - Other settings - Color space - Linear
- åœ¨æ‘„åƒæœºä¸Šæ·»åŠ  P*ost Process Layer* ç»„ä»¶
- åœ¨åœºæ™¯ä¸­æ·»åŠ  _Post Process Volume_ ç‰©ä½“
  - åœ¨ "Post Process Volume" ç»„ä»¶ä¸­ï¼Œå‹¾é€‰ "Is Global" é€‰é¡¹
  - ç‚¹å‡» "New" æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ "Profile" ï¼ˆåå¤„ç†é¢„è®¾æ–‡ä»¶ï¼‰
- åœ¨ _Post process volume profile_ ä¸­æ·»åŠ å„ç§åå¤„ç†æ•ˆæœï¼ˆè¾‰å…‰ã€æš—è§’ç­‰ï¼‰
- æ–°å»ºä¸€ä¸ª _post process layer_ ï¼Œå¹¶å°† post process volume è®¾å®šåˆ°è¿™ä¸ªå±‚ã€‚åœ¨æ‘„åƒæœºä¸­é€‰æ‹©åå¤„ç†çš„ mask ä¸º post process è¿™ä¸ªå±‚

<img
	src='/assets/TA/Shader/img6.png'
	alt='img6'
	style='width: 100%; height: auto; display:block; margin: 0 auto;'
/>

<br></br>
